============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\.env
============================================
#VITE_API_URL=http://213.232.235.205:4000
#VITE_API_URL=http://localhost:4000

VITE_API_URL= https://natalya-euphoric-unseverely.ngrok-free.dev





============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\eslint.config.js
============================================
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])


============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\index.html
============================================
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" sizes="32x32" href="https://res.cloudinary.com/ddnqbgqfn/image/upload/v1769537581/habana_express_store/img-1769548374002-829424593-logo.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Habana Express Store</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>


============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\package.json
============================================
{
  "name": "habana-express-app",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@apollo/client": "^3.8.8",
    "clsx": "^2.1.1",
    "graphql": "^16.12.0",
    "jwt-decode": "^4.0.0",
    "lucide-react": "^0.562.0",
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-hook-form": "^7.71.1",
    "react-hot-toast": "^2.6.0",
    "react-router-dom": "^7.12.0",
    "recharts": "^3.7.0",
    "tailwind-merge": "^3.4.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "autoprefixer": "^10.4.23",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.19",
    "vite": "^7.2.4"
  }
}


============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\postcss.config.js
============================================
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}


============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\README.md
============================================
<div align="center">

  <h1>üöÄ Habana Express APP</h1>
  <h3>Productos Internacionales al alcance de tu mano en un buen precio</h3>
<div align="center">

  <h1>üöÄ Habana Express - Dashboard & POS</h1>
  <h3>Sistema de Gesti√≥n de Inventario y Ventas para Retail en Cuba</h3>

  <p>
    <img src="https://img.shields.io/badge/React-18-blue?style=for-the-badge&logo=react" alt="React" />
    <img src="https://img.shields.io/badge/Vite-Fast-yellow?style=for-the-badge&logo=vite" alt="Vite" />
    <img src="https://img.shields.io/badge/Tailwind-CSS-38B2AC?style=for-the-badge&logo=tailwind-css" alt="Tailwind" />
    <img src="https://img.shields.io/badge/GraphQL-Apollo-E10098?style=for-the-badge&logo=graphql" alt="GraphQL" />
  </p>

  <p>
    <b>Frontend administrativo y operativo.</b><br>
    Gestiona inventario global, asignaciones a vendedores en consignaci√≥n,<br>
    y punto de venta (POS) con doble moneda (CUP/USD).
  </p>

</div>

<hr />

## üìã Descripci√≥n del Proyecto

**Habana Express App** es la interfaz de usuario para el ecosistema comercial de Habana Express. Est√° dise√±ada para resolver la complejidad del comercio en Cuba, permitiendo la gesti√≥n de precios din√°micos basados en la tasa de cambio diaria y un control estricto del stock en manos de vendedores.

### üåü Caracter√≠sticas Principales

*   **üõí Punto de Venta (POS):** Interfaz optimizada para vendedores. Muestra solo el stock asignado, calcula precios en tiempo real seg√∫n la tasa del d√≠a y muestra la ganancia estimada (comisi√≥n) por venta.
*   **üì¶ Inventario Dual:** Gesti√≥n de **Stock Global** (Almac√©n Central) vs **Stock Asignado** (En manos del vendedor).
*   **üë• Gesti√≥n de Roles:**
    *   **Admin:** Control total, reportes, gesti√≥n de usuarios, historial de ventas y configuraci√≥n.
    *   **Storekeeper (Almacenero):** Recepci√≥n de env√≠os, creaci√≥n de productos y asignaci√≥n de mercanc√≠a a vendedores.
    *   **Seller (Vendedor):** Acceso exclusivo al POS para vender su mercanc√≠a asignada.
*   **üí± Tasa de Cambio Din√°mica:** Sincronizaci√≥n autom√°tica o manual de la tasa del d√≥lar, actualizando precios de venta masivamente.
*   **üìâ Gesti√≥n de Devoluciones:** Flujo para retornar mercanc√≠a del vendedor al almac√©n principal.

---

## üõ†Ô∏è Tecnolog√≠as Utilizadas

Este proyecto fue construido con las mejores pr√°cticas de desarrollo moderno:

*   **Core:** React 18 + Vite (Build Tool).
*   **Estilos:** TailwindCSS (Utility-first CSS).
*   **Estado & Datos:** Apollo Client (Gesti√≥n de Estado y Caching de GraphQL).
*   **Formularios:** React Hook Form (Validaci√≥n y performance).
*   **Rutas:** React Router DOM v6.
*   **UI Components:** Lucide React (Iconograf√≠a), React Hot Toast (Notificaciones).

---

## üöÄ Instalaci√≥n y Puesta en Marcha

Sigue estos pasos para levantar el proyecto en tu entorno local.

### Prerrequisitos
*   Node.js (v18 o superior recomendado).
*   Tener el **Backend (API)** corriendo en el puerto `4000`.

### 1. Clonar el repositorio
```bash
git clone https://github.com/tu-usuario/habana-express-app.git
cd habana-express-app

2. Instalar dependencias

npm install

3. Configuraci√≥n de Entorno
Crea un archivo .env en la ra√≠z del proyecto (si no existe) y configura la URL de la API:
VITE_API_URL=http://localhost:4000

4. Ejecutar en Desarrollo

npm run dev

üìÇ Estructura del Proyecto
src/
‚îú‚îÄ‚îÄ components/        # Componentes reutilizables
‚îÇ   ‚îú‚îÄ‚îÄ layout/        # Navbar, Sidebar, Layout principal
‚îÇ   ‚îú‚îÄ‚îÄ products/      # Tarjetas, Modales de Edici√≥n/Asignaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ sales/         # Modales de Ventas
‚îÇ   ‚îú‚îÄ‚îÄ ui/            # Elementos gen√©ricos (ImageDropzone, etc.)
‚îÇ   ‚îî‚îÄ‚îÄ users/         # Gesti√≥n de usuarios
‚îú‚îÄ‚îÄ context/           # Contexto global (AuthContext)
‚îú‚îÄ‚îÄ graphql/           # Definiciones de Queries y Mutations
‚îú‚îÄ‚îÄ pages/             # Vistas principales (Rutas)
‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.jsx  # Panel de resumen
‚îÇ   ‚îú‚îÄ‚îÄ Inventory.jsx  # Gesti√≥n de productos
‚îÇ   ‚îú‚îÄ‚îÄ POS.jsx        # Punto de Venta (Vendedores)
‚îÇ   ‚îú‚îÄ‚îÄ Sales.jsx      # Historial de Ventas (Admin)
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ client.js          # Configuraci√≥n de Apollo Client
‚îú‚îÄ‚îÄ main.jsx           # Punto de entrada
‚îî‚îÄ‚îÄ App.jsx            # Configuraci√≥n de Rutas


üîê Flujo de Trabajo (L√≥gica de Negocio)
1. Ciclo de Inventario
Storekeeper crea un producto -> Stock entra al Almac√©n Global.
Storekeeper asigna 5 unidades al Vendedor A.
Stock Global: No cambia (es el total f√≠sico).
Stock Vendedor A: Aumenta a 5.
Vendedor A vende 1 unidad desde el POS.
Stock Global: Disminuye en 1.
Stock Vendedor A: Disminuye en 1.
2. Ciclo de Precios
El precio base se define en USD (Costo).
El sistema calcula el precio de venta en CUP usando la f√≥rmula: Costo * 2 * Tasa_Diaria.
Si la tasa cambia en Configuraci√≥n, todos los precios en CUP se actualizan al instante en el POS.
ü§ù Contribuci√≥n
Las Pull Requests son bienvenidas. Para cambios importantes, por favor abre primero un issue para discutir lo que te gustar√≠a cambiar.

<div align="center">
<small>Desarrollado para <b>Habana Express Store</b> ¬© 2026</small>
</div>

============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\tailwind.config.js
============================================
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        primary: {
          50: '#f0f9ff',
          100: '#e0f2fe',
          500: '#0ea5e9',
          600: '#0284c7', // Azul Habana Principal
          700: '#0369a1',
          800: '#075985', // Azul Oscuro (Textos / Navbar)
          900: '#0c4a6e',
        },
        secondary: {
          400: '#fbbf24',
          500: '#f59e0b', // Dorado Acento (Botones de acci√≥n)
          600: '#d97706',
        }
      },
      fontFamily: {
        sans: ['Inter', 'system-ui', 'sans-serif'],
      }
    },
  },
  plugins: [],
}

============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\vite.config.js
============================================
// import { defineConfig } from 'vite'
// import react from '@vitejs/plugin-react'

// // https://vite.dev/config/
// export default defineConfig({
//   plugins: [react()],
// })

import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react()],
  optimizeDeps: {
    include: ['@apollo/client', 'graphql'] // üëà Agrega esto para forzar la inclusi√≥n
  },
  build: {
    commonjsOptions: {
      transformMixedEsModules: true, // üëà Ayuda con librer√≠as mixtas como Apollo
    },
  },
})

============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\App.css
============================================
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}
.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\App.jsx
============================================
// src/App.jsx
import { Routes, Route, Navigate } from 'react-router-dom';
import { Toaster } from 'react-hot-toast';
import { useAuth } from './context/AuthContext';
import { Loader2 } from 'lucide-react';

// Importaci√≥n de Componentes y P√°ginas
import Layout from './components/layout/Layout';
import Login from './pages/Login';
import Settings from './pages/Settings';
import Categories from './pages/Categories';
import Users from './pages/Users';
import Shipments from './pages/Shipments';
import Dashboard from './pages/Dashboard';
import Inventory from './pages/Inventory';
import Returns from './pages/Returns';

// üëá 1. IMPORTAR LAS NUEVAS P√ÅGINAS
import POS from './pages/POS';
import Sales from './pages/Sales';

// --- COMPONENTE DE PROTECCI√ìN DE RUTAS ---
const PrivateRoute = ({ children }) => {
  const { user, loading } = useAuth();
  
  if (loading) {
    return (
      <div className="h-screen flex items-center justify-center bg-gray-50">
        <Loader2 className="animate-spin text-blue-600 h-10 w-10" />
      </div>
    );
  }
  
  return user ? children : <Navigate to="/login" replace />;
};

// --- APP PRINCIPAL ---
function App() {
  return (
    <>
      <Toaster position="top-center" toastOptions={{ duration: 4000 }} />
      
      <Routes>
        {/* Ruta P√∫blica */}
        {/* <Route path="/login" element={<Login />} /> */}
<Route path="/login" element={<Login />} />
        {/* Rutas Privadas */}
        <Route 
          path="/" 
          element={
            <PrivateRoute>
              <Layout>
                <Dashboard />
              </Layout>
            </PrivateRoute>
          } 
        />

        <Route 
          path="/inventory" 
          element={
            <PrivateRoute>
              <Layout>
                <Inventory />
              </Layout>
            </PrivateRoute>
          } 
        />

        {/* üëá 2. RUTA PARA VENDER (POS) */}
        <Route 
          path="/pos" 
          element={
            <PrivateRoute>
              <Layout>
                <POS />
              </Layout>
            </PrivateRoute>
          } 
        />

        {/* üëá 3. RUTA PARA HISTORIAL DE VENTAS (ADMIN) */}
        <Route 
          path="/sales" 
          element={
            <PrivateRoute>
              <Layout>
                <Sales />
              </Layout>
            </PrivateRoute>
          } 
        />

        <Route 
          path="/settings" 
          element={
            <PrivateRoute>
              <Layout>
                <Settings />
              </Layout>
            </PrivateRoute>
          } 
        />

        <Route 
          path="/categories" 
          element={
            <PrivateRoute>
              <Layout>
                <Categories />
              </Layout>
            </PrivateRoute>
          } 
        />

        <Route 
          path="/users" 
          element={
            <PrivateRoute>
              <Layout>
                <Users />
              </Layout>
            </PrivateRoute>
          } 
        />

        <Route 
          path="/shipments" 
          element={
            <PrivateRoute>
              <Layout>
                <Shipments />
              </Layout>
            </PrivateRoute>
          } 
        />

         <Route 
          path="/returns" 
          element={
            <PrivateRoute>
              <Layout>
                <Returns />
              </Layout>
            </PrivateRoute>
          } 
        />

        {/* Ruta por defecto */}
        <Route path="*" element={<Navigate to="/" replace />} />
      </Routes>
    </>
  );
}

export default App;.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\client.js
============================================
import { ApolloClient, InMemoryCache, createHttpLink } from '@apollo/client';
import { setContext } from '@apollo/client/link/context';

// 1. Configuraci√≥n del enlace HTTP (Din√°mico)
const apiUrl = import.meta.env.VITE_API_URL;

const httpLink = createHttpLink({
  uri: `${apiUrl}/graphql`, // Se conecta a /graphql
});

// 2. Middleware de Autenticaci√≥n
const authLink = setContext((_, { headers }) => {
  const token = localStorage.getItem('token');
  return {
    headers: {
      ...headers,
      authorization: token ? `Bearer ${token}` : "",
    }
  };
});

// 3. Inicializaci√≥n del Cliente
export const client = new ApolloClient({
  link: authLink.concat(httpLink),
  cache: new InMemoryCache(),
  defaultOptions: {
    watchQuery: {
      fetchPolicy: 'network-only',
    },
  },
});.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\index.css
============================================
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Opcional: Fuente Inter desde Google Fonts en index.html si quieres */
body {
  @apply bg-gray-50 text-gray-900;
}

@layer base {
  /* Evita zoom en iOS al tocar inputs */
  input, textarea, select {
    @apply text-base; 
  }
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\main.jsx
============================================
import React from 'react';
import ReactDOM from 'react-dom/client';
import { BrowserRouter } from 'react-router-dom';
import { ApolloProvider } from '@apollo/client';
import { AuthProvider } from './context/AuthContext';
import { client } from './client';
import App from './App';
import './index.css';

// Verificaci√≥n de seguridad para evitar "Target container is not a DOM element"
const rootElement = document.getElementById('root');

if (!rootElement) {
  throw new Error('No se encontr√≥ el elemento root en el HTML');
}

ReactDOM.createRoot(rootElement).render(
  <React.StrictMode>
    <ApolloProvider client={client}>
      <BrowserRouter>
        <AuthProvider>
          <App />
        </AuthProvider>
      </BrowserRouter>
    </ApolloProvider>
  </React.StrictMode>
);.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\components\categories\CategoryModal.jsx
============================================
// src/components/categories/CategoryModal.jsx
import { useEffect } from 'react';
import { useForm } from 'react-hook-form';
import { X, Save, Loader2 } from 'lucide-react';

export default function CategoryModal({ isOpen, onClose, categoryToEdit, onSave, isSaving }) {
  const { register, handleSubmit, reset, setValue } = useForm();

  // Efecto: Cuando abre el modal, decidimos si es "Crear" (limpiar) o "Editar" (llenar)
  useEffect(() => {
    if (isOpen) {
      if (categoryToEdit) {
        setValue('name', categoryToEdit.name);
      } else {
        reset();
      }
    }
  }, [isOpen, categoryToEdit, setValue, reset]);

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm transition-opacity">
      <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden animate-in fade-in zoom-in duration-200">
        
        {/* Header */}
        <div className="bg-gray-50 px-6 py-4 flex justify-between items-center border-b border-gray-100">
          <h3 className="text-lg font-bold text-gray-800">
            {categoryToEdit ? 'Editar Categor√≠a' : 'Nueva Categor√≠a'}
          </h3>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600 transition-colors">
            <X size={20} />
          </button>
        </div>

        {/* Formulario */}
        <form onSubmit={handleSubmit(onSave)} className="p-6">
          <div className="mb-6">
            <label className="block text-sm font-semibold text-gray-700 mb-2">Nombre de la Categor√≠a</label>
            <input
              {...register('name', { required: true })}
              placeholder="Ej: Electr√≥nica, Hogar..."
              className="w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all"
              autoFocus
            />
          </div>

          <div className="flex justify-end gap-3">
            <button
              type="button"
              onClick={onClose}
              className="px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"
            >
              Cancelar
            </button>
            <button
              type="submit"
              disabled={isSaving}
              className="flex items-center px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg shadow-md transition-all disabled:opacity-70"
            >
              {isSaving ? <Loader2 className="animate-spin h-5 w-5" /> : <Save className="h-5 w-5 mr-2" />}
              Guardar
            </button>
          </div>
        </form>
      </div>
    </div>
  );
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\components\dashboard\AdminDashboard.jsx
============================================
// src/components/dashboard/AdminDashboard.jsx
import { useQuery } from '@apollo/client';
import { GET_ADMIN_DASHBOARD } from '../../graphql/reports';
import { 
  BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, AreaChart, Area 
} from 'recharts';
import { Loader2, TrendingUp, DollarSign, Award, User } from 'lucide-react';

const MONTHS = ["Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"];

// Formateador de dinero para los tooltips
const formatCurrency = (value) => `$${new Intl.NumberFormat('en-US').format(value)}`;

export default function AdminDashboard() {
  const { data, loading, error } = useQuery(GET_ADMIN_DASHBOARD, { fetchPolicy: 'network-only' });

  if (loading) return <div className="h-64 flex items-center justify-center"><Loader2 className="animate-spin text-blue-600 h-8 w-8" /></div>;
  if (error) return <div className="p-4 text-red-500 bg-red-50 rounded-lg">Error cargando gr√°ficos: {error.message}</div>;

  // Preparar datos para gr√°ficos
  const chartData = data?.annualReport?.breakdown.map(item => ({
    name: MONTHS[item.month - 1], // Convertir 1 -> Ene
    Inversi√≥n: item.investment,
    Ganancia: item.profit,
    ROI: item.roiPercentage
  })) || [];

  const topSellers = data?.topSellers || [];

  return (
    <div className="space-y-6">
      
       {/* GR√ÅFICO 1: COSTO VS INVERSI√ìN */}
      <div className="bg-white p-5 rounded-[2.5rem] shadow-sm border border-gray-100">
        <h3 className="text-xs font-black text-gray-400 uppercase mb-6">Inversi√≥n vs Ganancia (USD)</h3>
        
        <div className="h-72 w-full">
            <ResponsiveContainer width="100%" height="100%">
              <AreaChart data={chartData} margin={{ top: 10, right: 10, left: -20, bottom: 0 }}>
                <defs>
                  <linearGradient id="colorGanancia" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="5%" stopColor="#16a34a" stopOpacity={0.2}/>
                    <stop offset="95%" stopColor="#16a34a" stopOpacity={0}/>
                  </linearGradient>
                </defs>
                <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f3f4f6" />
                <XAxis dataKey="name" axisLine={false} tickLine={false} tick={{fontSize: 10, fontWeight: 'bold'}} />
                <YAxis axisLine={false} tickLine={false} tick={{fontSize: 10, fontWeight: 'bold'}} />
                <Tooltip contentStyle={{ borderRadius: '15px', border: 'none', boxShadow: '0 10px 15px -3px rgba(0,0,0,0.1)' }} />
                <Legend iconType="circle" wrapperStyle={{ paddingTop: '20px', fontSize: '12px', fontWeight: 'bold' }} />
                
                {/* L√çNEA DE INVERSI√ìN: Ahora m√°s visible */}
                <Area type="monotone" dataKey="Inversi√≥n" stroke="#ef4444" strokeWidth={3} fill="transparent" />
                
                {/* L√çNEA DE GANANCIA: Con relleno suave */}
                <Area type="monotone" dataKey="Ganancia" stroke="#16a34a" strokeWidth={3} fillOpacity={1} fill="url(#colorGanancia)" />
              </AreaChart>
            </ResponsiveContainer>
        </div>
      </div>

      {/* GR√ÅFICO 2: ROI (BARRAS CON VALORES) */}
      <div className="bg-white p-5 rounded-[2.5rem] shadow-sm border border-gray-100">
        <h3 className="text-xs font-black text-gray-400 uppercase mb-6">Porcentaje de Retorno Mensual</h3>
        <div className="h-64 w-full">
            <ResponsiveContainer width="100%" height="100%">
              <BarChart data={chartData} margin={{ top: 20, right: 10, left: -20, bottom: 0 }}>
                <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f3f4f6" />
                <XAxis dataKey="name" axisLine={false} tickLine={false} tick={{fontSize: 10, fontWeight: 'bold'}} />
                <YAxis axisLine={false} tickLine={false} tick={{fontSize: 10, fontWeight: 'bold'}} unit="%" />
                <Tooltip cursor={{fill: '#f9fafb'}} contentStyle={{ borderRadius: '15px', border: 'none' }} />
                {/* Mostramos el valor encima de la barra para que no haya que adivinar */}
                <Bar dataKey="ROI" fill="#3b82f6" radius={[8, 8, 8, 8]} barSize={20} label={{ position: 'top', fontSize: 10, fontWeight: 'bold', fill: '#3b82f6' }} />
              </BarChart>
            </ResponsiveContainer>
        </div>
      </div>


      {/* 2. SECCI√ìN RANKING DE VENDEDORES (Con Fotos) */}
      <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
          <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
            <Award className="mr-2 text-yellow-500" size={20}/> Mejores Vendedores del A√±o
          </h3>
          
          <div className="overflow-x-auto">
              <table className="w-full text-left">
                  <thead>
                      <tr className="text-xs text-gray-400 uppercase border-b border-gray-100">
                          <th className="pb-3 pl-2">Posici√≥n / Vendedor</th>
                          <th className="pb-3 text-center">√çtems Vendidos</th>
                          <th className="pb-3 text-right pr-2">Total Generado (USD)</th>
                      </tr>
                  </thead>
                  <tbody className="divide-y divide-gray-50">
                      {topSellers.length === 0 ? (
                          <tr><td colSpan="3" className="text-center py-4 text-gray-400">Sin datos a√∫n</td></tr>
                      ) : topSellers.map((seller, idx) => (
                          <tr key={seller.id_user} className="group hover:bg-gray-50 transition-colors">
                              <td className="py-3 pl-2 flex items-center gap-3">
                                  {/* Medalla de Posici√≥n */}
                                  <div className={`h-6 w-6 rounded-full flex items-center justify-center font-bold text-xs text-white shrink-0 ${idx === 0 ? 'bg-yellow-400' : idx === 1 ? 'bg-gray-400' : idx === 2 ? 'bg-orange-400' : 'bg-blue-100 text-blue-600'}`}>
                                      {idx + 1}
                                  </div>

                                  {/* üëá FOTO DEL VENDEDOR */}
                                  <div className="h-10 w-10 rounded-full bg-gray-100 overflow-hidden border border-gray-200 shrink-0">
                                      {seller.photo_url ? (
                                          <img src={seller.photo_url} alt={seller.name} className="h-full w-full object-cover" />
                                      ) : (
                                          <User className="h-full w-full p-2 text-gray-400" />
                                      )}
                                  </div>

                                  <span className="font-bold text-gray-700 text-sm">{seller.name}</span>
                              </td>
                              <td className="py-3 text-center">
                                  <span className="bg-blue-50 text-blue-700 px-2 py-1 rounded-md text-xs font-bold">
                                      {seller.items_sold} unid.
                                  </span>
                              </td>
                              <td className="py-3 text-right pr-2 font-mono font-bold text-gray-600">
                                  ${new Intl.NumberFormat('en-US').format(seller.total_sales_usd)}
                              </td>
                          </tr>
                      ))}
                  </tbody>
              </table>
          </div>
      </div>

    </div>
  );
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\components\layout\Layout.jsx
============================================
// src/components/layout/Layout.jsx
import { useState, useEffect } from 'react';
import Navbar from './Navbar';
import Sidebar from './Sidebar';

export default function Layout({ children }) {
  // Estado inicial: Abierto en pantallas grandes, Cerrado en peque√±as
  const [isSidebarOpen, setSidebarOpen] = useState(window.innerWidth >= 1024);
  const [isMobile, setIsMobile] = useState(window.innerWidth < 1024);

  // Detectar cambio de tama√±o de pantalla
  useEffect(() => {
    const handleResize = () => {
      const mobile = window.innerWidth < 1024;
      setIsMobile(mobile);
      if (!mobile && !isSidebarOpen) setSidebarOpen(true); // Opcional: Auto abrir al agrandar
    };
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  return (
    <div className="flex flex-col h-screen bg-gray-50 overflow-hidden">
      
      {/* 1. Navbar Fijo Arriba */}
      <Navbar onMenuClick={() => setSidebarOpen(!isSidebarOpen)} />

      {/* 2. Contenedor Inferior (Sidebar + Contenido) */}
      <div className="flex flex-1 overflow-hidden">
        
        {/* Sidebar */}
        <Sidebar 
          isOpen={isSidebarOpen} 
          onClose={() => setSidebarOpen(false)} 
          isMobile={isMobile}
        />

        {/* √Årea Principal de Contenido */}
        <main className="flex-1 overflow-x-hidden overflow-y-auto bg-gray-50 p-4 md:p-8 transition-all duration-300">
          <div className="max-w-7xl mx-auto">
            {children}
          </div>
        </main>
      </div>
    </div>
  );
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\components\layout\Navbar.jsx
============================================
// src/components/layout/Navbar.jsx
import { useState, useRef, useEffect } from 'react';
// üëá AQU√ç ESTABAN FALTANDO IMPORTACIONES
import { Menu, User, ChevronDown, Database, Loader2, Phone, UserCog, LogOut } from 'lucide-react';
import { useAuth } from '../../context/AuthContext';
import clsx from 'clsx';

import { useMutation } from '@apollo/client';
import { UPDATE_USER } from '../../graphql/users';
import UserModal from '../users/UserModal';
import toast from 'react-hot-toast';

export default function Navbar({ onMenuClick }) {
  
  const { user, logout, updateUserState } = useAuth();
  const [isDropdownOpen, setIsDropdownOpen] = useState(false);
  const dropdownRef = useRef(null);
  const [isProfileModalOpen, setIsProfileModalOpen] = useState(false);
  
  // Estado para la descarga del backup
  const [isDownloading, setIsDownloading] = useState(false);

  const [updateUser, { loading: updating }] = useMutation(UPDATE_USER);

  const handleSelfUpdate = async (data) => {
    try {
        const input = {
            name: data.name,
            phone: data.phone,
            email: data.email,
            photo_url: data.photo_url,
            telegram_chat_id: data.telegram_chat_id,
        };
        if (data.password) input.password = data.password;

        const res = await updateUser({
            variables: { id_user: user.id_user, input }
        });

        const updatedUser = { ...user, ...res.data.updateUser };
        localStorage.setItem('user', JSON.stringify(updatedUser));
        
        updateUserState(res.data.updateUser); 
        toast.success('Perfil actualizado');
        setIsProfileModalOpen(false);
    } catch (e) {
        toast.error(e.message);
    }
  };

  // Funci√≥n de Backup
 const handleBackup = async () => {
  setIsDownloading(true);
  const toastId = toast.loading('Generando respaldo...');

  try {
    const token = localStorage.getItem('token');
    const API_URL = import.meta.env.VITE_API_URL;

    const response = await fetch(`${API_URL}/api/backup`, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`,
        // üëá A√ëADE ESTA L√çNEA PARA SALTAR LA ADVERTENCIA DE NGROK
        'ngrok-skip-browser-warning': 'true' 
      }
    });

    // Si ngrok todav√≠a devuelve algo que no es un archivo (como un error)
    if (!response.ok) throw new Error('Error al descargar respaldo');

    const blob = await response.blob();
    
    // Verificar si lo que recibimos es realmente un SQL o el HTML de error
    if (blob.type.includes('text/html')) {
        throw new Error('Ngrok bloque√≥ la petici√≥n. Intenta de nuevo.');
    }

    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    const date = new Date().toISOString().split('T')[0];
    a.download = `habana_backup_${date}.sql`;
    document.body.appendChild(a);
    a.click();
    
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);

    toast.success('Respaldo descargado', { id: toastId });
  } catch (error) {
    console.error(error);
    toast.error('No se pudo crear el respaldo', { id: toastId });
  } finally {
    setIsDownloading(false);
    setIsDropdownOpen(false);
  }
};

  useEffect(() => {
    function handleClickOutside(event) {
      if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
        setIsDropdownOpen(false);
      }
    }
    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, []);

  return (
    <header className="bg-gradient-to-r from-blue-600 to-indigo-600 shadow-md h-16 flex items-center justify-between px-4  z-[100] sticky top-0">
      
      {/* Bot√≥n Men√∫ */}
      <div className="flex items-center">
        <button 
          onClick={onMenuClick}
          className="p-2 rounded-lg text-white hover:bg-white/20 focus:outline-none transition-colors"
        >
          <Menu className="h-6 w-6" />
        </button>
      </div>

      {/* Perfil de Usuario */}
      <div className="ml-auto relative" ref={dropdownRef}>
        <button 
          onClick={() => setIsDropdownOpen(!isDropdownOpen)}
          className="flex items-center space-x-3 focus:outline-none group"
        >
            <div className="text-right hidden md:block">
                <p className="text-sm font-semibold text-white group-hover:text-blue-100 transition">{user?.name}</p>
                <p className="text-xs text-blue-200 capitalize">{user?.role}</p>
            </div>
            <div className="h-10 w-10 rounded-full bg-white/20 border-2 border-white/30 flex items-center justify-center overflow-hidden shadow-sm">
                {user?.photo_url ? (
                    <img src={user.photo_url} alt="User" className="h-full w-full object-cover" />
                ) : (
                    <User className="text-white h-6 w-6" />
                )}
            </div>
            {/* <ChevronDown className="h-4 w-4 text-blue-200" /> */}
        </button>

        {/* Dropdown Menu */}
        
        <div className={clsx(
            "absolute right-0 mt-2 w-64 bg-white rounded-xl shadow-xl py-2 transform transition-all duration-200 origin-top-right ring-1 ring-black ring-opacity-5 z-50",
            isDropdownOpen ? "opacity-100 scale-100" : "opacity-0 scale-95 pointer-events-none"
        )}>

            {/* Header del Dropdown con Tel√©fono */}
            <div className="px-4 py-3 border-b border-gray-100 bg-gray-50/50">
                <p className="text-xs text-gray-500 uppercase font-semibold mb-1">Cuenta Conectada</p>
                <div className="flex items-center gap-2 text-gray-700">
                    <Phone size={14} className="text-blue-500"/>
                    <p className="text-sm font-bold truncate">
                        {user?.phone || 'Sin tel√©fono'}
                    </p>
                </div>
            </div>

            <div className="py-2">
              {/* Bot√≥n Editar Perfil */}
              <button 
                onClick={() => {
                    setIsDropdownOpen(false);
                    setIsProfileModalOpen(true);
                }} 
                className="w-full text-left px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-3 transition-colors"
              >
                  <div className="p-1.5 bg-blue-50 text-blue-600 rounded-lg">
                    <UserCog size={16} />
                  </div>
                  <span className="font-medium">Editar Perfil</span>
              </button>

              {/* Bot√≥n Backup (Solo Admin) */}
              {user?.role === 'admin' && (
                 <button 
                   onClick={handleBackup}
                   disabled={isDownloading}
                   className="w-full text-left px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-3 transition-colors"
                 >
                    <div className="p-1.5 bg-purple-50 text-purple-600 rounded-lg">
                      {isDownloading ? <Loader2 className="animate-spin h-4 w-4"/> : <Database size={16} />}
                    </div>
                    <span className="font-medium">{isDownloading ? 'Generando...' : 'Respaldo BD'}</span>
                 </button>
              )}
              
              <div className="border-t border-gray-100 my-1"></div>

              {/* Bot√≥n Salir */}
              <button onClick={logout} className="w-full text-left px-4 py-2.5 text-sm text-red-600 hover:bg-red-50 flex items-center gap-3 transition-colors group">
                  <div className="p-1.5 bg-red-50 text-red-500 rounded-lg group-hover:bg-red-100 transition-colors">
                    <LogOut size={16} />
                  </div>
                  <span className="font-bold">Cerrar Sesi√≥n</span>
              </button>
            </div>
        </div>
      </div>

       <UserModal 
        isOpen={isProfileModalOpen}
        onClose={() => setIsProfileModalOpen(false)}
        userToEdit={user}
        onSave={handleSelfUpdate}
        isSaving={updating}
        isSelfEdit={true}
        isAdmin={user?.role === 'admin'}
      />
    </header>
  );
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\components\layout\Sidebar.jsx
============================================
// src/components/layout/Sidebar.jsx
import { NavLink } from 'react-router-dom';
import { useAuth } from '../../context/AuthContext';
import { useQuery } from '@apollo/client';
import { GET_CONFIG } from '../../graphql/configuration';
import { 
  LayoutDashboard, ShoppingBag, Package, Users, FileText, 
  Settings, LogOut, Truck, Tag, RotateCcw, ChevronRight 
} from 'lucide-react';
import clsx from 'clsx';

export default function Sidebar({ isOpen, onClose, isMobile }) {
  const { user, logout } = useAuth();
  
  // 1. Obtener el logo de la configuraci√≥n
  const { data: configData } = useQuery(GET_CONFIG);
  const systemLogo = configData?.systemConfiguration?.logo_url;
  const defaultLogo = "https://res.cloudinary.com/ddnqbgqfn/image/upload/v1769537581/habana_express_store/img-1769548374002-829424593-logo.png";

  const menus = [
    { name: 'Inicio', path: '/', icon: LayoutDashboard, roles: ['admin', 'seller', 'storekeeper'] },
    { name: 'Inventario', path: '/inventory', icon: Package, roles: ['storekeeper', 'admin'] },
    { name: 'Categor√≠as', path: '/categories', icon: Tag, roles: ['admin'] },
    { name: 'Devoluciones', path: '/returns', icon: RotateCcw, roles: ['admin', 'storekeeper'] },  
    { name: 'Vender', path: '/pos', icon: ShoppingBag, roles: ['seller'] }, 
    { name: 'Historial Ventas', path: '/sales', icon: FileText, roles: ['admin'] },
    { name: 'Env√≠os', path: '/shipments', icon: Truck, roles: ['admin'] },
    { name: 'Usuarios', path: '/users', icon: Users, roles: ['admin'] },
    { name: 'Configuraci√≥n', path: '/settings', icon: Settings, roles: ['admin'] },
  ];

  const allowedMenus = menus.filter(item => item.roles.includes(user?.role));

  // src/components/layout/Sidebar.jsx
// ... (imports y l√≥gica inicial igual)

return (
  <>
    {/* OVERLAY: Fondo oscuro con transici√≥n de opacidad lenta */}
    <div 
      className={clsx(
        "fixed inset-0 bg-black/40 backdrop-blur-sm lg:hidden",
        "z-[80] top-[64px]", 
        "transition-opacity duration-500 ease-in-out", // üëà Transici√≥n lenta
        (isOpen && isMobile) ? "opacity-100" : "opacity-0 pointer-events-none"
      )}
      onClick={onClose}
    />

    {/* SIDEBAR: Con transici√≥n de movimiento y ancho */}
    <aside 
      className={clsx(
        "bg-white flex flex-col border-r border-gray-100",
        "z-[90] fixed left-0 top-[64px] h-[calc(100vh-64px)]", 
        "transition-all duration-500 ease-in-out transform", // üëà Transici√≥n lenta y suave
        
        // L√≥gica de visibilidad
        isOpen 
          ? "translate-x-0 w-72 opacity-100" 
          : "-translate-x-full w-0 lg:w-0 opacity-0 pointer-events-none",
        
        // En escritorio, si est√° abierto, usamos sticky para que empuje el contenido suavemente
        !isMobile && isOpen && "sticky"
      )}
    >
      {/* 
          IMPORTANTE: Envolvemos el contenido en un div de ancho fijo 
          para que el texto NO se amontone mientras el sidebar se cierra.
      */}
      <div className="w-72 flex flex-col h-full flex-shrink-0">
        
        {/* --- CABECERA CON LOGO --- */}
        <div className="flex flex-col items-center justify-center py-6 px-4 border-b border-gray-50 bg-gradient-to-b from-gray-50/50 to-white flex-shrink-0">
          <div className="relative h-20 w-full flex items-center justify-center">
             <div className="absolute inset-0 bg-blue-50 rounded-full opacity-40 blur-md transform scale-75"></div>
             <img 
                src={systemLogo || defaultLogo} 
                className="relative max-h-full max-w-[80%] object-contain rounded-full" 
                alt="Habana Express"
             />
          </div>
          <h2 className="mt-3 text-lg font-black text-gray-800 tracking-tighter leading-none whitespace-nowrap">
            Habana<span className="text-blue-600">Express</span>
          </h2>
        </div>

        {/* --- NAVEGACI√ìN --- */}
        <nav className="flex-1 overflow-y-auto py-4 px-4 space-y-1.5 custom-scrollbar">
          {allowedMenus.map((item) => (
            <NavLink
              key={item.path}
              to={item.path}
              onClick={() => isMobile && onClose()}
              className={({ isActive }) => clsx(
                "flex items-center justify-between px-4 py-3.5 text-sm font-bold rounded-2xl transition-all duration-300 whitespace-nowrap",
                isActive 
                  ? "bg-blue-600 text-white shadow-lg shadow-blue-200" 
                  : "text-gray-500 hover:bg-gray-50 hover:text-gray-900"
              )}
            >
              <div className="flex items-center">
                <item.icon className="mr-3 h-5 w-5 flex-shrink-0" />
                <span>{item.name}</span>
              </div>
            </NavLink>
          ))}
        </nav>

        {/* --- FOOTER --- */}
        <div className="p-4 border-t border-gray-50 flex-shrink-0 bg-gray-50/30">
           <button 
             onClick={logout} 
             className="flex items-center justify-center w-full px-4 py-3 text-xs font-black text-red-500 bg-red-50 hover:bg-red-100 rounded-xl transition-all active:scale-95 uppercase tracking-widest whitespace-nowrap"
           >
             <LogOut className="mr-2 h-4 w-4" />
             Cerrar Sesi√≥n
           </button>
        </div>
      </div>
    </aside>
  </>
);
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\components\products\AssignmentModal.jsx
============================================
import { useEffect } from 'react';
import { useForm } from 'react-hook-form';
import { useQuery } from '@apollo/client';
import { GET_USERS } from '../../graphql/users'; // Aseg√∫rate que esta query traiga users
import { X, Save, Loader2, UserPlus, Package } from 'lucide-react';

export default function AssignmentModal({ isOpen, onClose, product, onAssign, isAssigning }) {
  const { register, handleSubmit, reset, watch, setValue } = useForm();
  
  // 1. Traemos usuarios para llenar el select (Solo vendedores activos)
  const { data: usersData, loading: loadingUsers } = useQuery(GET_USERS);
  
  // Filtramos solo los que son vendedores (role: 'seller') y est√°n activos
  const sellers = usersData?.users?.filter(u => u.role === 'seller' && u.active) || [];

  useEffect(() => {
    if (isOpen) {
      reset({ quantity: 1 }); // Resetear form al abrir
    }
  }, [isOpen, product, reset]);

  if (!isOpen || !product) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm transition-opacity">
      <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md animate-in fade-in zoom-in duration-200">
        
        {/* Header */}
        <div className="bg-blue-600 px-6 py-4 flex justify-between items-center border-b border-blue-500 rounded-t-2xl">
          <h3 className="text-lg font-bold text-white flex items-center">
            <UserPlus className="mr-2 h-5 w-5" />
            Asignar Mercanc√≠a
          </h3>
          <button onClick={onClose} className="text-blue-100 hover:text-white transition-colors">
            <X size={20} />
          </button>
        </div>

        {/* Info del Producto */}
        <div className="bg-blue-50 px-6 py-3 border-b border-blue-100 flex items-center gap-3">
             <div className="h-10 w-10 bg-white rounded-lg border border-blue-100 flex items-center justify-center overflow-hidden">
                {product.photo_url ? (
                    <img src={product.photo_url} alt="" className="h-full w-full object-cover" />
                ) : (
                    <Package className="text-blue-300" size={20} />
                )}
             </div>
             <div>
                 <p className="font-bold text-gray-800 text-sm">{product.name}</p>
                 <p className="text-xs text-gray-500">Stock Global Disponible: <span className="font-bold text-blue-600">{product.stock}</span></p>
             </div>
        </div>

        <form onSubmit={handleSubmit(onAssign)} className="p-6 space-y-5">
          
          {/* Selector de Vendedor */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-1">Seleccionar Vendedor</label>
            {loadingUsers ? (
                <div className="text-sm text-gray-400 flex items-center"><Loader2 className="animate-spin h-4 w-4 mr-2"/> Cargando vendedores...</div>
            ) : (
                <select 
                    {...register('sellerId', { required: true })}
                    className="w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none bg-white"
                >
                    <option value="">-- Elige un vendedor --</option>
                    {sellers.map(seller => (
                        <option key={seller.id_user} value={seller.id_user}>
                            {seller.name} ({seller.phone})
                        </option>
                    ))}
                </select>
            )}
          </div>

          {/* Cantidad */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-1">Cantidad a Entregar</label>
            <div className="flex items-center gap-3">
                <input 
                    type="number" 
                    min="1"
                    max={product.stock} // Opcional: limitar al stock global
                    {...register('quantity', { required: true, min: 1 })}
                    className="w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none text-lg font-bold"
                />
                <span className="text-sm text-gray-400 font-medium">unidades</span>
            </div>
            <p className="text-xs text-gray-400 mt-2">
                ‚ö†Ô∏è Esto sumar√° al stock que ya tenga este vendedor.
            </p>
          </div>

          {/* Actions */}
          <div className="flex justify-end gap-3 pt-2">
            <button
              type="button"
              onClick={onClose}
              className="px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"
            >
              Cancelar
            </button>
            <button
              type="submit"
              disabled={isAssigning}
              className="flex items-center px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg shadow-md transition-all disabled:opacity-70"
            >
              {isAssigning ? <Loader2 className="animate-spin h-5 w-5 mr-2" /> : <Save className="h-5 w-5 mr-2" />}
              Confirmar Asignaci√≥n
            </button>
          </div>

        </form>
      </div>
    </div>
  );
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\components\products\ProductCard.jsx
============================================
// src/components/products/ProductCard.jsx
import { Edit2, Package, Power, Trash2, UserPlus  } from 'lucide-react'; // Agregamos Trash2
import clsx from 'clsx';

export default function ProductCard({ product, onEdit, onDelete, onReactivate, onAssign, isInactiveView }) {
  
  // Procesamos categor√≠as para mostrarlas
  const categories = product.product_categories?.map(pc => pc.category.name) || [];

  return (
    <div className="bg-white rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition-all duration-300 overflow-hidden flex flex-col h-full group">
      
      {/* 1. IMAGEN */}
      <div className="relative h-48 w-full bg-gray-50 overflow-hidden">
        {product.photo_url ? (
          <img 
            src={product.photo_url} 
            alt={product.name} 
            className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
          />
        ) : (
          <div className="flex items-center justify-center h-full text-gray-300">
            <Package size={48} />
          </div>
        )}

        {/* Badge Garant√≠a Flotante (Si tiene) */}
        {product.warranty && (
            <div className="absolute top-2 right-2 bg-red-500 text-white text-[10px] font-bold px-2 py-1 rounded-full shadow-sm z-10">
              GARANT√çA
            </div>
        )}
      </div>

      {/* 2. CONTENIDO */}
      <div className="p-4 flex-1 flex flex-col">
        
        {/* T√≠tulo */}
        <h3 className="font-bold text-gray-800 text-lg leading-tight line-clamp-2 mb-1" title={product.name}>
             {product.name}
        </h3>

        {/* Categor√≠as (Debajo del nombre) */}
        <div className="flex flex-wrap gap-1 mb-3">
          {categories.length > 0 ? (
            categories.map((cat, idx) => (
              <span key={idx} className="text-[10px] font-medium text-blue-600 bg-blue-50 px-1.5 py-0.5 rounded border border-blue-100">
                {cat}
              </span>
            ))
          ) : (
            <span className="text-[10px] text-gray-400 italic">Sin categor√≠a</span>
          )}
        </div>

        <div className="mt-auto space-y-3">
            {/* Precios */}
            <div className="flex justify-between items-end border-t border-gray-50 pt-3">
               <div className="flex flex-col">
                  <span className="text-[10px] text-gray-400 font-bold uppercase tracking-wider">Costo (USD)</span>
                  <span className="text-xl font-bold text-gray-500">${product.purchase_price}</span>
               </div>
               <div className="flex flex-col items-end">
                  {/* CAMBIO: Especificamos CUP expl√≠citamente */}
                  <span className="text-[10px] text-blue-400 font-bold uppercase tracking-wider">Venta (CUP)</span>
                  <span className="text-xl font-bold text-blue-600">${product.sale_price}</span>
               </div>
            </div>

            {/* Stock y Acciones */}
            <div className="flex items-center justify-between pt-2">
                
                {/* Stock */}
                <div className={clsx(
                    "flex items-center px-2 py-1 rounded-lg text-xs font-bold",
                    product.stock === 0 ? "bg-red-100 text-red-700" :
                    product.stock < 3 ? "bg-orange-100 text-orange-700" :
                    "bg-green-100 text-green-700"
                )}>
                    <Package size={14} className="mr-1.5" />
                    {product.stock === 0 ? "Agotado" : `${product.stock} Stock`}
                </div>

                {/* Botones de Acci√≥n */}
                <div className="flex gap-2">
                   {isInactiveView ? (
                      <button 
                        onClick={() => onReactivate(product)}
                        className="p-2 bg-green-50 text-green-600 hover:bg-green-100 rounded-xl transition-colors"
                        title="Reactivar y poner stock en 1"
                      >
                         <Power size={18} />
                      </button>
                   ) : (
                      <>

{/* üÜï BOT√ìN ASIGNAR (Solo si onAssign existe, es decir, Storekeeper/Admin) */}
                        {onAssign && (
                            <button 
                                onClick={() => onAssign(product)}
                                className="p-2 bg-purple-50 text-purple-600 hover:bg-purple-100 rounded-xl transition-colors"
                                title="Asignar a Vendedor"
                            >
                                <UserPlus size={18} />
                            </button>
                        )}

                        <button 
                            onClick={() => onEdit(product)}
                            className="p-2 bg-blue-50 text-blue-600 hover:bg-blue-100 rounded-xl transition-colors"
                            title="Editar"
                        >
                            <Edit2 size={18} />
                        </button>
                        {/* Bot√≥n Borrado L√≥gico */}
                        <button 
                            onClick={() => onDelete(product)}
                            className="p-2 bg-red-50 text-red-500 hover:bg-red-100 rounded-xl transition-colors"
                            title="Enviar a Papelera"
                        >
                            <Trash2 size={18} />
                        </button>
                      </>
                   )}
                </div>
            </div>
        </div>
      </div>
    </div>
  );
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\components\products\ProductModal.jsx
============================================
import { useEffect } from 'react';
import { useForm, Controller } from 'react-hook-form';
import { X, Save, Loader2, ShieldCheck, FileText, Truck } from 'lucide-react'; 
import ImageDropzone from '../ui/ImageDropzone';

export default function ProductModal({ isOpen, onClose, productToEdit, categories, onSave, isSaving }) {
  
  const emptyState = {
  name: '',
  description: '',
  stock: 1,
  purchase_price: 0,
  sale_price: 0,
  sku: '',
  supplier_name: '',
  photo_url: '',
  warranty: false,
  categoryIds: []
};

const { register, handleSubmit, reset, control, setValue } = useForm({
    defaultValues: emptyState
  });
  
   
  // 2Ô∏è‚É£ CHANGE: Efecto de carga corregido
  useEffect(() => {
    if (isOpen) {
      if (productToEdit) {
        // MODO EDICI√ìN: Cargamos datos del producto
        const catIds = productToEdit.product_categories?.map(pc => String(pc.category.id_category)) || [];
        reset({
          name: productToEdit.name,
          description: productToEdit.description || '',
          sku: productToEdit.sku || '',
          supplier_name: productToEdit.supplier_name || '',
          purchase_price: productToEdit.purchase_price,
          sale_price: productToEdit.sale_price,
          stock: productToEdit.stock,
          photo_url: productToEdit.photo_url || '',
          warranty: productToEdit.warranty,
          categoryIds: catIds
        });
      } else {
        // MODO CREAR: Forzamos el reset con el objeto vac√≠o completo
        reset(emptyState); 
      }
    }
  }, [isOpen, productToEdit, reset]);

 const handleFormSubmit = (data) => {
      // Conversi√≥n segura: Si viene vac√≠o o inv√°lido, ponemos 0
      const cleanData = {
          ...data,
          stock: data.stock ? parseInt(data.stock) : 0,
          purchase_price: data.purchase_price ? parseFloat(data.purchase_price) : 0,
          sale_price: data.sale_price ? parseFloat(data.sale_price) : 0,
          // Asegurar que categoryIds es un array de n√∫meros
          categoryIds: (data.categoryIds && Array.isArray(data.categoryIds))
              ? data.categoryIds.map(id => parseInt(id)) 
              : []
      };
      
      console.log("Datos enviados al padre:", cleanData); // Para depurar en consola (F12)
      onSave(cleanData);
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm transition-opacity overflow-y-auto">
      <div className="bg-white rounded-2xl shadow-2xl w-full max-w-3xl my-8 flex flex-col max-h-[90vh]">
        
        {/* Header ... */}
        <div className="bg-gray-50 px-6 py-4 flex justify-between items-center border-b border-gray-100 rounded-t-2xl flex-shrink-0">
          <h3 className="text-lg font-bold text-gray-800">
            {productToEdit ? 'Editar Producto' : 'Nuevo Producto'}
          </h3>
          <button onClick={onClose}><X size={20} className="text-gray-400 hover:text-gray-600" /></button>
        </div>

        {/* Formulario ... */}
        <div className="overflow-y-auto p-6">
            <form id="product-form" onSubmit={handleSubmit(handleFormSubmit)} className="space-y-6">
            
            <div className="flex flex-col md:flex-row gap-6">
                
                {/* Lado Izquierdo... */}
                <div className="md:w-1/3 flex flex-col space-y-4">
                     {/* ... ImageDropzone ... */}
                     <div className="flex flex-col items-center p-4 border border-gray-100 rounded-2xl bg-gray-50/50">
                        <label className="text-sm font-semibold text-gray-700 mb-3">Foto del Producto</label>
                        <Controller
                            control={control}
                            name="photo_url"
                            render={({ field: { value, onChange } }) => (
                                <ImageDropzone value={value} onChange={onChange} className="w-40 h-40 rounded-2xl shadow-sm" />
                            )}
                        />
                    </div>

                    <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-1">Categor√≠as</label>
                        <select 
                            {...register('categoryIds')} 
                            multiple 
                            className="w-full px-3 py-2 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none h-32 text-sm"
                        >
                            {categories.map(cat => (
                                // IMPORTANTE: value debe coincidir con el tipo que seteamos en reset (String)
                                <option key={cat.id_category} value={String(cat.id_category)}>{cat.name}</option>
                            ))}
                        </select>
                        <p className="text-[10px] text-gray-400 mt-1 text-center">Mant√©n Ctrl para seleccionar varias</p>
                    </div>
                </div>

                {/* Lado Derecho ... */}
                <div className="md:w-2/3 space-y-4">
                    {/* ... Inputs Nombre, Proveedor, Stock, Precios ... */}
                    {/* (El resto de inputs se mantienen igual, el reset() ya los maneja bien) */}
                    
                     {/* Nombre */}
                    <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-1">Nombre del Producto *</label>
                        <input {...register('name', { required: true })} className="w-full px-4 py-2 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Ej: iPhone 15 Pro Max" />
                    </div>

                    {/* Proveedor y Stock */}
                    <div className="grid grid-cols-2 gap-4">
                        <div>
                             <label className="block text-sm font-semibold text-gray-700 mb-1">Proveedor</label>
                             <div className="relative">
                                <Truck size={16} className="absolute left-3 top-2.5 text-gray-400"/>
                                <input {...register('supplier_name')} className="w-full pl-9 pr-3 py-2 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Ej: Amazon" />
                             </div>
                        </div>
                        <div>
                             <label className="block text-sm font-semibold text-gray-700 mb-1">Stock Inicial *</label>
                             <input type="number" {...register('stock', { required: true })} className="w-full px-4 py-2 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none" />
                        </div>
                    </div>

                    {/* Precios */}
                    <div className="grid grid-cols-2 gap-4 bg-blue-50/30 p-4 rounded-xl border border-blue-100">
                        <div>
                            <label className="block text-xs font-bold text-gray-500 uppercase mb-1">Costo (USD) *</label>
                            <div className="relative">
                                <span className="absolute left-3 top-2 text-gray-500 font-bold">$</span>
                                <input type="number" step="0.01" {...register('purchase_price', { required: true })} className="w-full pl-6 pr-3 py-2 rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none font-semibold text-gray-700" placeholder="0.00" />
                            </div>
                        </div>
                        <div>
                            <label className="block text-xs font-bold text-blue-500 uppercase mb-1">Venta (CUP) *</label>
                            <div className="relative">
                                <span className="absolute left-3 top-2 text-blue-500 font-bold">$</span>
                                <input type="number" step="0.01" {...register('sale_price', { required: true })} className="w-full pl-6 pr-3 py-2 rounded-lg border border-blue-200 focus:ring-2 focus:ring-blue-500 outline-none font-bold text-blue-700" placeholder="0.00" />
                            </div>
                        </div>
                    </div>

                    {/* Descripci√≥n (Aseg√∫rate que el textarea est√° bien registrado) */}
                    <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-1">Descripci√≥n</label>
                        <div className="relative">
                            <FileText size={16} className="absolute left-3 top-3 text-gray-400" />
                            <textarea 
                                {...register('description')} 
                                rows={3} 
                                className="w-full pl-9 pr-3 py-2 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none resize-none" 
                                placeholder="Detalles t√©cnicos, estado, etc..."
                            />
                        </div>
                    </div>

                     {/* Checkbox Garant√≠a */}
                    <div className="flex items-center space-x-2">
                        <input type="checkbox" id="warranty" {...register('warranty')} className="w-5 h-5 text-blue-600 rounded focus:ring-blue-500 border-gray-300" />
                        <label htmlFor="warranty" className="text-sm font-medium text-gray-700 flex items-center cursor-pointer select-none">
                            <ShieldCheck size={16} className="mr-1 text-green-600" /> Este producto incluye garant√≠a
                        </label>
                    </div>

                </div>
            </div>
            </form>
        </div>

        {/* Footer ... */}
        <div className="bg-gray-50 px-6 py-4 border-t border-gray-100 flex justify-end gap-3 rounded-b-2xl flex-shrink-0">
            <button type="button" onClick={onClose} className="px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-lg">Cancelar</button>
            <button form="product-form" type="submit" disabled={isSaving} className="flex items-center px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg shadow-md disabled:opacity-70 transition-transform active:scale-95">
              {isSaving ? <Loader2 className="animate-spin h-5 w-5 mr-2" /> : <Save className="h-5 w-5 mr-2" />}
              Guardar
            </button>
        </div>

      </div>
    </div>
  );
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\components\sales\MobileCartSheet.jsx
============================================
// src/components/sales/MobileCartSheet.jsx
import { X, Trash2, Plus, Minus, Loader2 } from 'lucide-react';

export default function MobileCartSheet({ 
  isOpen, 
  onClose, 
  cart, 
  updateQty, 
  removeFromCart, 
  totalCUP, 
  estimatedCommission,
  buyerPhone,
  setBuyerPhone,
  paymentMethod,
  setPaymentMethod,
  handleCheckout,
  processing 
}) {
  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 md:hidden flex flex-col bg-gray-100 animate-in slide-in-from-bottom duration-300">
      
      {/* HEADER */}
      <div className="bg-white px-4 py-3 flex justify-between items-center shadow-sm border-b">
        <h2 className="font-bold text-lg text-gray-800">Tu Carrito ({cart.length})</h2>
        <button onClick={onClose} className="p-2 bg-gray-100 rounded-full hover:bg-gray-200">
          <X size={20} />
        </button>
      </div>

      {/* BODY: LISTA DE ITEMS */}
      <div className="flex-1 overflow-y-auto p-4 space-y-3">
        {cart.length === 0 ? (
          <div className="flex flex-col items-center justify-center h-full text-gray-400">
             <p>El carrito est√° vac√≠o</p>
          </div>
        ) : (
          cart.map(item => (
            <div key={item.id} className="bg-white p-3 rounded-xl shadow-sm border border-gray-100 flex gap-3">
               {/* Imagen peque√±a */}
               <div className="h-16 w-16 bg-gray-50 rounded-lg flex-shrink-0 overflow-hidden">
                  {item.photo ? <img src={item.photo} className="w-full h-full object-cover"/> : null}
               </div>
               
               {/* Info */}
               <div className="flex-1 flex flex-col justify-between">
                  <div className="flex justify-between">
                     <span className="font-bold text-sm text-gray-800 line-clamp-1">{item.name}</span>
                     <button onClick={() => removeFromCart(item.id)} className="text-red-400">
                        <Trash2 size={16} />
                     </button>
                  </div>
                  
                  <div className="flex justify-between items-end">
                     <span className="text-blue-600 font-bold text-sm">${item.price * item.qty}</span>
                     
                     {/* Controles Cantidad */}
                     <div className="flex items-center bg-gray-100 rounded-lg overflow-hidden">
                        <button onClick={() => updateQty(item.id, -1)} className="p-1 px-2 active:bg-gray-200"><Minus size={14}/></button>
                        <span className="w-6 text-center text-sm font-bold">{item.qty}</span>
                        <button onClick={() => updateQty(item.id, 1)} className="p-1 px-2 active:bg-gray-200"><Plus size={14}/></button>
                     </div>
                  </div>
               </div>
            </div>
          ))
        )}
      </div>

      {/* FOOTER: COBRO */}
      <div className="bg-white p-4 border-t border-gray-200 rounded-t-2xl shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
         {/* Datos Cliente */}
         <div className="mb-4">
            <input 
              type="tel" 
              placeholder="üì± Tel√©fono del Cliente" 
              className="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 font-medium text-lg" 
              value={buyerPhone} 
              onChange={e => setBuyerPhone(e.target.value)} 
            />
         </div>

         {/* M√©todo Pago */}
         <div className="grid grid-cols-2 gap-3 mb-4">
             <button 
                onClick={() => setPaymentMethod('cash')} 
                className={`py-3 rounded-xl font-bold text-sm border transition-all ${paymentMethod==='cash' ? 'bg-green-100 border-green-500 text-green-700 shadow-sm' : 'bg-white border-gray-200 text-gray-500'}`}
             >
                üíµ Efectivo
             </button>
             <button 
                onClick={() => setPaymentMethod('transfer')} 
                className={`py-3 rounded-xl font-bold text-sm border transition-all ${paymentMethod==='transfer' ? 'bg-blue-100 border-blue-500 text-blue-700 shadow-sm' : 'bg-white border-gray-200 text-gray-500'}`}
             >
                üè¶ Transferencia
             </button>
         </div>

         {/* Totales */}
         <div className="flex justify-between items-center mb-4">
             <div className="text-xs text-gray-500">
                <p>Comisi√≥n estimada: <span className="text-green-600 font-bold">+${estimatedCommission.toFixed(0)}</span></p>
                <p>{cart.length} Art√≠culos</p>
             </div>
             <div className="text-right">
                <span className="text-gray-400 text-xs font-bold uppercase">Total a Cobrar</span>
                <p className="text-2xl font-black text-gray-900">${totalCUP.toFixed(0)}</p>
             </div>
         </div>

         <button 
            onClick={handleCheckout} 
            disabled={processing || cart.length===0} 
            className="w-full py-4 bg-blue-600 text-white font-bold rounded-xl text-lg hover:bg-blue-700 disabled:opacity-50 active:scale-95 transition-transform shadow-lg shadow-blue-200"
         >
             {processing ? <Loader2 className="animate-spin mx-auto"/> : "CONFIRMAR VENTA"}
         </button>
      </div>
    </div>
  );
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\components\sales\SaleModal.jsx
============================================
// src/components/sales/SaleModal.jsx
import { useEffect } from 'react';
import { useForm } from 'react-hook-form';
import { X, Save, Loader2, DollarSign, Phone, FileText, CreditCard, TrendingUp, ShoppingBag } from 'lucide-react';

export default function SaleModal({ isOpen, onClose, saleToEdit, onSave, isSaving }) {
  const { register, handleSubmit, setValue, reset } = useForm();

  useEffect(() => {
    if (isOpen && saleToEdit) {
      reset({
        total_cup: saleToEdit.total_cup,
        exchange_rate: saleToEdit.exchange_rate,
        buyer_phone: saleToEdit.buyer_phone,
        payment_method: saleToEdit.payment_method,
        notes: saleToEdit.notes || ''
      });
    }
  }, [isOpen, saleToEdit, reset]);

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-2 md:p-4 bg-black/60 backdrop-blur-sm transition-opacity">
      <div className="bg-white rounded-[2rem] shadow-2xl w-full max-w-md flex flex-col max-h-[95vh] overflow-hidden animate-in zoom-in duration-200">
        
        {/* HEADER FIJO */}
        <div className="px-6 py-5 flex justify-between items-center border-b border-gray-50 flex-shrink-0">
          <div className="flex items-center gap-3">
            <div className="p-2 bg-blue-50 text-blue-600 rounded-xl">
              <ShoppingBag size={20} />
            </div>
            <h3 className="text-xl font-black text-gray-800 tracking-tight">Venta #{saleToEdit?.id_sale}</h3>
          </div>
          <button onClick={onClose} className="p-2 bg-gray-50 text-gray-400 rounded-full"><X size={20} /></button>
        </div>

        {/* CUERPO CON SCROLL */}
        <form id="sale-edit-form" onSubmit={handleSubmit(onSave)} className="flex-1 overflow-y-auto p-6 space-y-5 custom-scrollbar">
          
          <div className="p-4 bg-blue-50/50 rounded-2xl border border-blue-100 mb-2">
             <p className="text-[10px] font-black text-blue-600 uppercase mb-1">Responsable</p>
             <p className="text-sm font-bold text-gray-700">{saleToEdit?.seller?.name}</p>
          </div>

          <div className="space-y-1">
             <label className="text-[10px] font-black text-gray-400 uppercase ml-1">Total Cobrado (CUP)</label>
             <div className="relative">
                <DollarSign className="absolute left-4 top-3.5 text-blue-500" size={18}/>
                <input type="number" step="0.01" {...register('total_cup')} className="w-full pl-11 pr-4 py-3 bg-gray-50 border-none rounded-2xl font-black text-gray-700 outline-none focus:ring-2 focus:ring-blue-500" />
             </div>
          </div>

          <div className="space-y-1">
             <label className="text-[10px] font-black text-gray-400 uppercase ml-1">Tel√©fono del Cliente</label>
             <div className="relative">
                <Phone className="absolute left-4 top-3.5 text-gray-300" size={18}/>
                <input {...register('buyer_phone')} className="w-full pl-11 pr-4 py-3 bg-gray-50 border-none rounded-2xl outline-none font-bold" />
             </div>
          </div>

          <div className="grid grid-cols-2 gap-4">
              <div className="space-y-1">
                  <label className="text-[10px] font-black text-gray-400 uppercase ml-1">M√©todo Pago</label>
                  <div className="relative">
                    <CreditCard className="absolute left-4 top-3.5 text-gray-300" size={18}/>
                    <select {...register('payment_method')} className="w-full pl-11 pr-4 py-3 bg-gray-50 border-none rounded-2xl outline-none font-bold appearance-none">
                        <option value="cash">Efectivo</option>
                        <option value="transfer">Transf.</option>
                    </select>
                  </div>
              </div>
              <div className="space-y-1">
                  <label className="text-[10px] font-black text-gray-400 uppercase ml-1">Tasa Aplicada</label>
                  <div className="relative">
                    <TrendingUp className="absolute left-4 top-3.5 text-gray-300" size={18}/>
                    <input type="number" {...register('exchange_rate')} className="w-full pl-11 pr-4 py-3 bg-gray-50 border-none rounded-2xl outline-none font-bold" />
                  </div>
              </div>
          </div>

          <div className="space-y-1">
             <label className="text-[10px] font-black text-gray-400 uppercase ml-1">Notas de la operaci√≥n</label>
             <div className="relative">
                <FileText className="absolute left-4 top-4 text-gray-300" size={18}/>
                <textarea {...register('notes')} rows={2} className="w-full pl-11 pr-4 py-3 bg-gray-50 border-none rounded-2xl outline-none resize-none" placeholder="Agregar nota..." />
             </div>
          </div>
        </form>

        {/* FOOTER FIJO */}
        <div className="p-6 border-t border-gray-50 bg-gray-50/30 flex justify-end gap-3 flex-shrink-0">
             <button type="button" onClick={onClose} className="px-6 py-3 text-sm font-bold text-gray-400">Cancelar</button>
             <button form="sale-edit-form" type="submit" disabled={isSaving} className="px-8 py-3 bg-blue-600 text-white font-black rounded-2xl shadow-lg shadow-blue-100 flex items-center gap-2 active:scale-95 transition-all">
                 {isSaving && <Loader2 className="animate-spin" size={18}/>} GUARDAR
             </button>
        </div>
      </div>
    </div>
  );
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\components\shipments\ShipmentModal.jsx
============================================
// src/components/shipments/ShipmentModal.jsx
import { useEffect } from 'react';
import { useForm } from 'react-hook-form';
import { X, Save, Loader2, Truck, Calendar, DollarSign, FileText, Globe, Box } from 'lucide-react';

const formatDateForInput = (rawDate) => {
  if (!rawDate) return '';
  const date = new Date(Number(rawDate) || rawDate);
  if (isNaN(date.getTime())) return '';
  return date.toISOString().split('T')[0];
};

const emptyShipmentState = {
  agency_name: '',
  shipment_date: new Date().toISOString().split('T')[0],
  shipping_cost_usd: 0,
  merchandise_cost_usd: 0,
  customs_fee_cup: 0,
  exchange_rate: 0,
  notes: ''
};

export default function ShipmentModal({ isOpen, onClose, shipmentToEdit, onSave, isSaving }) {
   const { register, handleSubmit, reset, setValue } = useForm({
    defaultValues: emptyShipmentState
  });

  useEffect(() => {
    if (isOpen) {
      if (shipmentToEdit) {
        // MODO EDICI√ìN
        reset({
          agency_name: shipmentToEdit.agency_name,
          shipment_date: formatDateForInput(shipmentToEdit.shipment_date),
          shipping_cost_usd: shipmentToEdit.shipping_cost_usd,
          merchandise_cost_usd: shipmentToEdit.merchandise_cost_usd,
          customs_fee_cup: shipmentToEdit.customs_fee_cup,
          exchange_rate: shipmentToEdit.exchange_rate,
          notes: shipmentToEdit.notes || ''
        });
      } else {
        // MODO CREAR: Reset total
        reset(emptyShipmentState);
      }
    }
  }, [isOpen, shipmentToEdit, reset]);

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-2 md:p-4 bg-black/60 backdrop-blur-sm transition-opacity">
      <div className="bg-white rounded-[2rem] shadow-2xl w-full max-w-2xl flex flex-col max-h-[95vh] overflow-hidden animate-in zoom-in duration-200">
        
        {/* HEADER FIJO */}
        <div className="px-6 py-5 flex justify-between items-center border-b border-gray-50 flex-shrink-0">
          <div className="flex items-center gap-3">
            <div className="p-2 bg-blue-50 text-blue-600 rounded-xl">
              <Truck size={20} />
            </div>
            <h3 className="text-xl font-black text-gray-800 tracking-tight">
                {shipmentToEdit ? 'Editar Env√≠o' : 'Nuevo Env√≠o'}
            </h3>
          </div>
          <button onClick={onClose} className="p-2 bg-gray-50 text-gray-400 rounded-full"><X size={20} /></button>
        </div>

        {/* CUERPO CON SCROLL */}
        <form id="shipment-form" onSubmit={handleSubmit(onSave)} className="flex-1 overflow-y-auto p-6 space-y-6 custom-scrollbar">
          
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <div className="col-span-1 md:col-span-2 space-y-1">
              <label className="text-[10px] font-black text-gray-400 uppercase ml-1">Agencia / Courier</label>
              <input {...register('agency_name', { required: true })} className="w-full px-4 py-3 bg-gray-50 border-none rounded-2xl font-bold outline-none" placeholder="Ej: Aerovaradero" />
            </div>

            <div className="space-y-1">
              <label className="text-[10px] font-black text-gray-400 uppercase ml-1">Fecha de Env√≠o</label>
              <div className="relative">
                <Calendar className="absolute left-4 top-3.5 text-gray-300" size={18} />
                <input type="date" {...register('shipment_date', { required: true })} className="w-full pl-11 pr-4 py-3 bg-gray-50 border-none rounded-2xl outline-none font-bold" />
              </div>
            </div>

             <div className="space-y-1">
              <label className="text-[10px] font-black text-gray-400 uppercase ml-1">Tasa Mercado (CUP)</label>
              <div className="relative">
                <Globe className="absolute left-4 top-3.5 text-gray-300" size={18} />
                <input type="number" step="0.01" {...register('exchange_rate', { required: true })} className="w-full pl-11 pr-4 py-3 bg-gray-50 border-none rounded-2xl outline-none font-bold" />
              </div>
            </div>

            <div className="space-y-1">
              <label className="text-[10px] font-black text-gray-400 uppercase ml-1">Costo Flete (USD)</label>
              <div className="relative">
                 <DollarSign className="absolute left-4 top-3.5 text-blue-500" size={18} />
                 <input type="number" step="0.01" {...register('shipping_cost_usd', { required: true })} className="w-full pl-11 pr-4 py-3 bg-gray-50 border-none rounded-2xl outline-none font-black text-gray-700" />
              </div>
            </div>

            <div className="space-y-1">
              <label className="text-[10px] font-black text-gray-400 uppercase ml-1">Costo Mercanc√≠a (USD)</label>
              <div className="relative">
                 <Box className="absolute left-4 top-3.5 text-blue-500" size={18} />
                 <input type="number" step="0.01" {...register('merchandise_cost_usd', { required: true })} className="w-full pl-11 pr-4 py-3 bg-gray-50 border-none rounded-2xl outline-none font-black text-gray-700" />
              </div>
            </div>

            <div className="col-span-1 md:col-span-2 space-y-1">
              <label className="text-[10px] font-black text-gray-400 uppercase ml-1">Aranceles Aduana (CUP)</label>
              <div className="relative">
                 <span className="absolute left-4 top-3 text-orange-500 font-black text-xs">CUP</span>
                 <input type="number" step="0.01" {...register('customs_fee_cup', { required: true })} className="w-full pl-12 pr-4 py-3 bg-orange-50 border-none rounded-2xl outline-none font-black text-orange-700" />
              </div>
            </div>

            <div className="col-span-1 md:col-span-2 space-y-1">
              <label className="text-[10px] font-black text-gray-400 uppercase ml-1">Notas</label>
              <textarea {...register('notes')} rows={2} className="w-full px-4 py-3 bg-gray-50 border-none rounded-2xl outline-none resize-none" />
            </div>
          </div>
        </form>

        {/* FOOTER FIJO */}
        <div className="p-6 border-t border-gray-50 bg-gray-50/30 flex justify-end gap-3 flex-shrink-0">
          <button type="button" onClick={onClose} className="px-5 py-3 text-sm font-bold text-gray-400">Cancelar</button>
          <button form="shipment-form" type="submit" disabled={isSaving} className="px-8 py-3 bg-blue-600 text-white font-black rounded-2xl shadow-lg shadow-blue-100 flex items-center gap-2 active:scale-95 transition-all">
            {isSaving ? <Loader2 className="animate-spin" size={18} /> : <Save size={18} />}
            GUARDAR
          </button>
        </div>
      </div>
    </div>
  );
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\components\ui\ImageDropzone.jsx
============================================
import { useState } from 'react';
import { UploadCloud, X, Loader2, Image as ImageIcon } from 'lucide-react';
import toast from 'react-hot-toast';

export default function ImageDropzone({ value, onChange, className }) {
  const [isUploading, setIsUploading] = useState(false);

  // Obtener URL base desde variables de entorno
  const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:4000';

  const handleFileChange = async (e) => {
    const file = e.target.files[0];
    if (!file) return;

    // Validaci√≥n b√°sica
    if (!file.type.startsWith('image/')) {
      toast.error('Solo se permiten im√°genes');
      return;
    }

    setIsUploading(true);
    const formData = new FormData();
    formData.append('file', file);

    try {
      const res = await fetch(`${API_URL}/api/upload`, {
        method: 'POST',
        body: formData,
      });

      if (!res.ok) throw new Error('Error subiendo imagen');

      const data = await res.json();
      // data.url ahora ser√° la URL de Cloudinary (https://res.cloudinary...)
      onChange(data.url); 
      toast.success('Foto subida');
    } catch (error) {
      console.error(error);
      toast.error('Error al subir la imagen');
    } finally {
      setIsUploading(false);
    }
  };

  const handleRemove = (e) => {
    e.preventDefault(); 
    onChange('');
  };

  return (
    <div className={`relative group w-32 h-32 rounded-full border-4 border-dashed border-gray-200 overflow-hidden bg-gray-50 hover:border-blue-400 transition-colors cursor-pointer ${className}`}>
      
      <input 
        type="file" 
        accept="image/*" 
        onChange={handleFileChange}
        disabled={isUploading}
        className="absolute inset-0 w-full h-full opacity-0 z-10 cursor-pointer"
      />

      <div className="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
        {isUploading ? (
          <div className="flex flex-col items-center text-blue-500">
            <Loader2 className="animate-spin h-8 w-8 mb-1" />
            <span className="text-[10px] font-bold">SUBIENDO...</span>
          </div>
        ) : value ? (
          <>
            <img src={value} alt="Preview" className="w-full h-full object-cover" />
            <div className="absolute inset-0 bg-black/40 flex flex-col items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
               <UploadCloud className="text-white h-8 w-8" />
               <span className="text-white text-[10px] font-bold mt-1">CAMBIAR</span>
            </div>
          </>
        ) : (
          <div className="text-gray-400 flex flex-col items-center px-2 text-center">
            <ImageIcon className="h-8 w-8 mb-1" />
            <span className="text-[10px] leading-tight">Click para subir foto</span>
          </div>
        )}
      </div>

      {value && !isUploading && (
        <button 
          onClick={handleRemove}
          className="absolute top-1 right-1 z-20 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 shadow-md transition-transform hover:scale-110"
          type="button"
        >
          <X size={12} />
        </button>
      )}
    </div>
  );
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\components\ui\TablePagination.jsx
============================================
// src/components/ui/TablePagination.jsx
import { ChevronLeft, ChevronRight } from 'lucide-react';

export default function TablePagination({ currentPage, totalItems, itemsPerPage, onPageChange }) {
  const totalPages = Math.ceil(totalItems / itemsPerPage);

  // Si no hay suficientes datos para m√°s de una p√°gina, no mostramos nada
  if (totalPages <= 1) return null;

  // Calcular rangos para mostrar "Viendo 1-10 de 50"
  const startItem = (currentPage - 1) * itemsPerPage + 1;
  const endItem = Math.min(startItem + itemsPerPage - 1, totalItems);

  return (
    <div className="flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6 mt-4 rounded-b-xl">
      
      {/* --- VISTA MOVIL (Simplificada) --- */}
      <div className="flex flex-1 justify-between sm:hidden">
        <button
          onClick={() => onPageChange(currentPage - 1)}
          disabled={currentPage === 1}
          className="relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Anterior
        </button>
        <span className="text-sm flex items-center font-medium text-gray-600">
           {currentPage} / {totalPages}
        </span>
        <button
          onClick={() => onPageChange(currentPage + 1)}
          disabled={currentPage === totalPages}
          className="relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Siguiente
        </button>
      </div>

      {/* --- VISTA ESCRITORIO (Completa) --- */}
      <div className="hidden sm:flex sm:flex-1 sm:items-center sm:justify-between">
        <div>
          <p className="text-sm text-gray-700">
            Mostrando <span className="font-medium">{startItem}</span> a <span className="font-medium">{endItem}</span> de{' '}
            <span className="font-medium">{totalItems}</span> resultados
          </p>
        </div>
        
        <div className="flex gap-2">
            <button
                onClick={() => onPageChange(currentPage - 1)}
                disabled={currentPage === 1}
                className="relative inline-flex items-center rounded-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
            >
                <ChevronLeft className="h-5 w-5" />
            </button>
            
            <div className="flex items-center px-4 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 rounded-md bg-gray-50">
                P√°gina {currentPage} de {totalPages}
            </div>

            <button
                onClick={() => onPageChange(currentPage + 1)}
                disabled={currentPage === totalPages}
                className="relative inline-flex items-center rounded-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
            >
                <ChevronRight className="h-5 w-5" />
            </button>
        </div>
      </div>
    </div>
  );
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\components\users\UserModal.jsx
============================================
// src/components/users/UserModal.jsx
import { useEffect } from 'react';
import { useForm, Controller } from 'react-hook-form';
import { X, Save, Loader2, User, Phone, Mail, Lock, Shield, Send } from 'lucide-react';
import ImageDropzone from '../ui/ImageDropzone';

export default function UserModal({ 
  isOpen, 
  onClose, 
  userToEdit, 
  onSave, 
  isSaving, 
  isSelfEdit = false, 
  isAdmin = false 
}) {
  const { register, handleSubmit, reset, control, setValue } = useForm();

  // Resetear el formulario cuando el modal abre o cambia el usuario a editar
  useEffect(() => {
    if (isOpen) {
      if (userToEdit) {
        reset({
          name: userToEdit.name || '',
          phone: userToEdit.phone || '',
          email: userToEdit.email || '',
          photo_url: userToEdit.photo_url || '',
          telegram_chat_id: userToEdit.telegram_chat_id || '',
          role: userToEdit.role || 'seller',
          password: '' // Password siempre vac√≠o por seguridad al cargar
        });
      } else {
        reset({
          name: '',
          phone: '',
          email: '',
          photo_url: '',
          telegram_chat_id: '',
          role: 'seller',
          password: ''
        });
      }
    }
  }, [isOpen, userToEdit, reset]);

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-2 md:p-4 bg-black/60 backdrop-blur-sm transition-opacity">
      
      {/* CONTENEDOR PRINCIPAL: max-h-[95vh] permite que no se corte en m√≥viles */}
      <div className="bg-white rounded-[2rem] shadow-2xl w-full max-w-2xl flex flex-col max-h-[95vh] overflow-hidden animate-in zoom-in duration-200">
        
        {/* HEADER: Fijo arriba */}
        <div className="bg-white px-6 py-5 flex justify-between items-center border-b border-gray-50 flex-shrink-0">
          <div className="flex items-center gap-3">
            <div className="p-2 bg-blue-50 text-blue-600 rounded-xl">
              <User size={20} />
            </div>
            <h3 className="text-xl font-black text-gray-800 tracking-tight">
              {isSelfEdit ? 'Mi Perfil' : (userToEdit ? 'Editar Usuario' : 'Nuevo Usuario')}
            </h3>
          </div>
          <button 
            onClick={onClose} 
            className="p-2 bg-gray-50 text-gray-400 rounded-full hover:bg-gray-100 transition-colors"
          >
            <X size={20} />
          </button>
        </div>

        {/* CUERPO: Scrollable para formularios largos en m√≥vil */}
        <form 
          id="user-form" 
          onSubmit={handleSubmit(onSave)} 
          className="flex-1 overflow-y-auto p-6 md:p-8 space-y-6 custom-scrollbar"
        >
          <div className="flex flex-col md:flex-row gap-8">
            
            {/* COLUMNA IZQUIERDA: FOTO */}
            <div className="flex flex-col items-center md:w-1/3 space-y-4">
              <span className="text-[10px] font-black text-gray-400 uppercase tracking-widest">Foto de Perfil</span>
              <Controller
                control={control}
                name="photo_url"
                render={({ field: { value, onChange } }) => (
                  <ImageDropzone value={value} onChange={onChange} className="w-32 h-32 md:w-40 md:h-40 shadow-inner" />
                )}
              />
              <p className="text-[10px] text-center text-gray-400 leading-tight px-4">
                Sube una imagen cuadrada para mejores resultados.
              </p>
            </div>

            {/* COLUMNA DERECHA: DATOS */}
            <div className="md:w-2/3 space-y-5">
              
              {/* Nombre */}
              <div className="space-y-1">
                <label className="text-[10px] font-black text-gray-400 uppercase ml-1">Nombre Completo</label>
                <div className="relative">
                   <User className="absolute left-4 top-3.5 text-gray-300" size={18} />
                   <input 
                    {...register('name', { required: true })} 
                    className="w-full pl-11 pr-4 py-3 bg-gray-50 border-none rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none font-bold text-gray-700" 
                    placeholder="Juan P√©rez" 
                   />
                </div>
              </div>

              {/* Tel√©fono & Email */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="space-y-1">
                  <label className="text-[10px] font-black text-gray-400 uppercase ml-1">Tel√©fono (Login)</label>
                  <div className="relative">
                    <Phone className="absolute left-4 top-3.5 text-gray-300" size={18} />
                    <input 
                      {...register('phone', { required: true })} 
                      className="w-full pl-11 pr-4 py-3 bg-gray-50 border-none rounded-2xl outline-none font-mono font-bold" 
                      placeholder="50000000"
                    />
                  </div>
                </div>
                <div className="space-y-1">
                  <label className="text-[10px] font-black text-gray-400 uppercase ml-1">Email</label>
                  <div className="relative">
                    <Mail className="absolute left-4 top-3.5 text-gray-300" size={18} />
                    <input 
                      {...register('email')} 
                      className="w-full pl-11 pr-4 py-3 bg-gray-50 border-none rounded-2xl outline-none font-medium" 
                      placeholder="ejemplo@mail.com"
                    />
                  </div>
                </div>
              </div>

              {/* Password */}
              <div className="space-y-1">
                 <label className="text-[10px] font-black text-gray-400 uppercase ml-1">
                    {userToEdit ? 'Cambiar Contrase√±a (Opcional)' : 'Contrase√±a *'}
                 </label>
                 <div className="relative">
                    <Lock className="absolute left-4 top-3.5 text-gray-300" size={18} />
                    <input 
                      type="password" 
                      {...register('password', { required: !userToEdit })} 
                      placeholder={userToEdit ? "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" : "M√≠nimo 6 caracteres"}
                      className="w-full pl-11 pr-4 py-3 bg-gray-50 border-none rounded-2xl outline-none" 
                    />
                 </div>
              </div>

              {/* Rol y Telegram */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div className="space-y-1">
                    <label className="text-[10px] font-black text-gray-400 uppercase ml-1">Rol de Acceso</label>
                    <div className="relative">
                        <Shield className="absolute left-4 top-3.5 text-gray-300" size={18} />
                        <select 
                            {...register('role')} 
                            disabled={!isAdmin || isSelfEdit}
                            className="w-full pl-11 pr-4 py-3 bg-gray-50 border-none rounded-2xl outline-none appearance-none font-bold text-gray-700 disabled:opacity-50"
                        >
                            <option value="seller">Vendedor</option>
                            <option value="storekeeper">Almacenero</option>
                            <option value="admin">Administrador</option>
                        </select>
                    </div>
                  </div>

                  <div className="space-y-1">
                     <label className="text-[10px] font-black text-gray-400 uppercase ml-1">Telegram Chat ID</label>
                     <div className="relative">
                        <Send className="absolute left-4 top-3.5 text-gray-300" size={18} />
                        <input 
                          {...register('telegram_chat_id')} 
                          className="w-full pl-11 pr-4 py-3 bg-gray-50 border-none rounded-2xl outline-none font-mono text-xs" 
                          placeholder="ID de Chat" 
                        />
                     </div>
                  </div>
              </div>

            </div>
          </div>
        </form>

        {/* FOOTER: Fijo abajo con botones */}
        <div className="p-6 border-t border-gray-50 bg-gray-50/30 flex justify-end gap-3 flex-shrink-0">
          <button
            type="button"
            onClick={onClose}
            className="px-6 py-3 text-sm font-bold text-gray-400 hover:text-gray-600 transition-colors"
          >
            Cancelar
          </button>
          <button
            form="user-form"
            type="submit"
            disabled={isSaving}
            className="flex items-center gap-2 px-8 py-3 bg-blue-600 text-white font-black rounded-2xl shadow-lg shadow-blue-100 transition-all active:scale-95 disabled:opacity-50"
          >
            {isSaving ? <Loader2 className="animate-spin" size={18} /> : <Save size={18} />}
            {userToEdit ? 'GUARDAR CAMBIOS' : 'CREAR USUARIO'}
          </button>
        </div>

      </div>
    </div>
  );
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\context\AuthContext.jsx
============================================
// src/context/AuthContext.jsx
import { createContext, useState, useEffect, useContext } from 'react';
import { jwtDecode } from 'jwt-decode';
import { useNavigate } from 'react-router-dom'; // <--- Importar
import { useApolloClient } from '@apollo/client'; // <--- Importar para limpiar cach√©

const AuthContext = createContext();

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const navigate = useNavigate();
  const client = useApolloClient(); // Acceso al cliente de Apollo

  useEffect(() => {
    const token = localStorage.getItem('token');
    const storedUser = localStorage.getItem('user');

    if (token && storedUser) {
      try {
        const decoded = jwtDecode(token);
        if (decoded.exp * 1000 < Date.now()) {
          logout();
        } else {
          setUser(JSON.parse(storedUser));
        }
      } catch (e) {
        logout();
      }
    }
    setLoading(false);
  }, []);

  const login = (token, userData) => {
    localStorage.setItem('token', token);
    localStorage.setItem('user', JSON.stringify(userData));
    setUser(userData);
  };

  // Funci√≥n para actualizar los datos del usuario en tiempo real sin recargar
  const updateUserState = (newUserData) => {
    const updatedUser = { ...user, ...newUserData };
    localStorage.setItem('user', JSON.stringify(updatedUser));
    setUser(updatedUser);
  };

  const logout = async () => {
    localStorage.removeItem('token');
    localStorage.removeItem('user');
    setUser(null);
    
    // 1. Limpiamos la cach√© de Apollo (datos en memoria) sin recargar
    await client.clearStore(); 
    
    // 2. Navegamos al login usando React Router
    navigate('/login'); 
  };

  return (
    <AuthContext.Provider value={{ user, login, logout, loading, updateUserState }}>
      {!loading && children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => useContext(AuthContext);.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\graphql\auth.js
============================================
// src/graphql/auth.js
import { gql } from '@apollo/client';


export const LOGIN_MUTATION = gql`
  mutation Login($phone: String!, $password: String!) {
    login(phone: $phone, password: $password) {
      token
      user {
        id_user
        name
        role
        photo_url
        
        # ‚úÖ AGREGAMOS ESTOS CAMPOS FALTANTES:
        phone
        email
        telegram_chat_id
      }
    }
  }
`;.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\graphql\categories.js
============================================
// src/graphql/categories.js
import { gql } from '@apollo/client';

export const GET_CATEGORIES = gql`
  query GetCategories {
    categories {
      id_category
      name
      active
    }
  }
`;

export const CREATE_CATEGORY = gql`
  mutation CreateCategory($name: String!) {
    createCategory(name: $name) {
      id_category
      name
    }
  }
`;

export const UPDATE_CATEGORY = gql`
  mutation UpdateCategory($id_category: Int!, $name: String!) {
    updateCategory(id_category: $id_category, name: $name) {
      id_category
      name
    }
  }
`;

export const DELETE_CATEGORY = gql`
  mutation DeleteCategory($id_category: Int!) {
    deleteCategory(id_category: $id_category) {
      id_category
      active
    }
  }
`;.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\graphql\configuration.js
============================================
import { gql } from '@apollo/client';

export const GET_CONFIG = gql`
  query GetSystemConfiguration {
    systemConfiguration {
      id_config
      company_name
      company_phone
      company_email
      logo_url  # <--- NUEVO CAMPO
      description
      seller_commission_percentage
      default_exchange_rate
      telegram_bot_token
      active
      exchange_rate_sync_time
      monthly_report_day
      monthly_report_time
      annual_report_day
      annual_report_time
    }
  }
`;

export const UPDATE_CONFIG = gql`
  mutation UpdateSystemConfiguration($id_config: Int!, $input: UpdateSystemConfigurationInput!) {
    updateSystemConfiguration(id_config: $id_config, input: $input) {
      id_config
      company_name
    }
  }
`;

export const TRIGGER_SYNC = gql`
  mutation TriggerPriceSync {
    triggerPriceSync
  }
`;.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\graphql\products.js
============================================
import { gql } from '@apollo/client';



export const CREATE_PRODUCT = gql`
  mutation CreateProduct($input: CreateProductInput!) {
    createProduct(input: $input) {
      id_product
      name
    }
  }
`;

export const UPDATE_PRODUCT = gql`
  mutation UpdateProduct($id_product: Int!, $input: UpdateProductInput!) {
    updateProduct(id_product: $id_product, input: $input) {
      id_product
      name
      stock
      active
    }
  }
`;

export const GET_PRODUCTS = gql`
  query GetProducts($active: Boolean) {
    products(active: $active) {
      id_product
      name
      description
      purchase_price
      sale_price
      stock
      sku
      
      supplier_name  # üëà ¬°AGREGA ESTA L√çNEA!
      
      photo_url
      warranty
      active
      product_categories {
        category {
          id_category
          name
        }
      }
    }
  }
`;



export const ASSIGN_PRODUCT = gql`
  mutation AssignProductToSeller($sellerId: Int!, $productId: Int!, $quantity: Int!) {
    assignProductToSeller(sellerId: $sellerId, productId: $productId, quantity: $quantity) {
      id_seller_product
      quantity
      seller {
        name
      }
    }
  }
`;

// Obtener productos espec√≠ficos asignados a un vendedor
export const GET_SELLER_PRODUCTS = gql`
  query GetSellerProducts($sellerId: Int!) {
    sellerProducts(sellerId: $sellerId) {
      id_seller_product
      quantity
      assigned_at
      product {
        id_product
        name
        photo_url
        sale_price
        stock # Stock global para referencia
      }
    }
  }
`;

// Devolver producto del vendedor al almac√©n
export const RETURN_PRODUCT_FROM_SELLER = gql`
  mutation ReturnProductFromSeller($sellerId: Int!, $productId: Int!, $quantity: Int!) {
    returnProductFromSeller(sellerId: $sellerId, productId: $productId, quantity: $quantity) {
      id_seller_product
      quantity
    }
  }
`;.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\graphql\reports.js
============================================
import { gql } from '@apollo/client';


export const GET_DASHBOARD_STATS = gql`
  query GetDashboardStats {
    dashboardStats {
      exchangeRate
      activeProductsCount
      totalItemsSold
    }
  }
`;

// üëá NUEVA QUERY PARA GR√ÅFICOS ADMIN
export const GET_ADMIN_DASHBOARD = gql`
  query GetAdminDashboard {
    annualReport {
      year
      totalNetProfit
      breakdown {
        month
        investment      # Costo Total
        profit          # Ganancia Neta
        roiPercentage   # ROI %
      }
    }
    topSellers(period: "year") {
      id_user
      name
      photo_url
      total_sales_usd
      items_sold
    }
  }
`;.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\graphql\sales.js
============================================
import { gql } from '@apollo/client';

export const CREATE_SALE = gql`
  mutation CreateSale(
    $sellerId: Int!,
    $exchange_rate: Float!,
    $total_cup: Float!,
    $buyer_phone: String!,
    $payment_method: PaymentMethod!,
    $notes: String,
    $items: [SaleItemInput!]!
  ) {
    createSale(
      sellerId: $sellerId,
      exchange_rate: $exchange_rate,
      total_cup: $total_cup,
      buyer_phone: $buyer_phone,
      payment_method: $payment_method,
      notes: $notes,
      items: $items
    ) {
      id_sale
      total_cup
    }
  }
`;

export const GET_SALES = gql`
  query GetSales {
    sales {
      id_sale
      sale_date
      total_cup
      buyer_phone
      payment_method
      exchange_rate
      status        # <--- ¬°IMPORTANTE!
      notes
      seller { 
        id_user
        name 
      }
      sale_products {
        id_product  # <--- Necesario para devoluciones
        quantity
        product { 
            id_product
            name 
        }
      }
    }
  }
`;

export const UPDATE_SALE = gql`
  mutation UpdateSale($id_sale: Int!, $input: UpdateSaleInput!) {
    updateSale(id_sale: $id_sale, input: $input) {
      id_sale
      total_cup
    }
  }
`;

// ‚úÖ CAMBIO DE NOMBRE: De DELETE_SALE a CANCEL_SALE
export const CANCEL_SALE = gql`
  mutation CancelSale($id_sale: Int!) {
    cancelSale(id_sale: $id_sale) {
      id_sale
      status
    }
  }
`;

// Ojo: Mantengo DELETE_SALE por si acaso tienes alg√∫n c√≥digo viejo que lo llame, 
// pero deber√≠as dejar de usarlo. Si no lo usas, b√≥rralo.
export const DELETE_SALE = gql`
  mutation DeleteSale($id_sale: Int!) {
    deleteSale(id_sale: $id_sale) {
      id_sale
    }
  }
`;

// ‚úÖ NUEVA PARA DEVOLUCIONES
export const CREATE_RETURN = gql`
  mutation CreateReturn($saleId: Int!, $productId: Int!, $quantity: Int!, $reason: String, $returnToStock: Boolean!) {
    createReturn(saleId: $saleId, productId: $productId, quantity: $quantity, reason: $reason, returnToStock: $returnToStock) {
      id_return
    }
  }
`;.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\graphql\shipments.js
============================================
import { gql } from '@apollo/client';

export const GET_SHIPMENTS = gql`
  query GetShipments {
    shipments {
      id_shipment
      agency_name
      shipment_date
      shipping_cost_usd
      merchandise_cost_usd
      customs_fee_cup
      exchange_rate
      notes
    }
  }
`;

export const CREATE_SHIPMENT = gql`
  mutation CreateShipment(
    $agency_name: String!, 
    $shipment_date: String!, 
    $shipping_cost_usd: Float!, 
    $merchandise_cost_usd: Float!, 
    $customs_fee_cup: Float!, 
    $exchange_rate: Float!, 
    $notes: String
  ) {
    createShipment(
      agency_name: $agency_name, 
      shipment_date: $shipment_date, 
      shipping_cost_usd: $shipping_cost_usd, 
      merchandise_cost_usd: $merchandise_cost_usd, 
      customs_fee_cup: $customs_fee_cup, 
      exchange_rate: $exchange_rate, 
      notes: $notes
    ) {
      id_shipment
      agency_name
    }
  }
`;
export const UPDATE_SHIPMENT = gql`
  mutation UpdateShipment($id_shipment: Int!, $input: UpdateShipmentInput!) {
    updateShipment(id_shipment: $id_shipment, input: $input) {
      id_shipment
      agency_name
      shipment_date
      shipping_cost_usd
      merchandise_cost_usd
      customs_fee_cup
      exchange_rate
      notes
    }
  }
`;

export const DELETE_SHIPMENT = gql`
  mutation DeleteShipment($id_shipment: Int!) {
    deleteShipment(id_shipment: $id_shipment) {
      id_shipment
    }
  }
`;.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\graphql\users.js
============================================
// src/graphql/users.js
import { gql } from '@apollo/client';

export const GET_USERS = gql`
  query GetUsers {
    users {
      id_user
      name
      phone
      email
      role
      active
      photo_url
      telegram_chat_id
    }
  }
`;

export const GET_ME = gql`
  query GetMe {
    me {
      id_user
      name
      phone
      email
      role
      photo_url
      telegram_chat_id
    }
  }
`;

export const CREATE_USER = gql`
  mutation CreateUser($input: CreateUserInput!) {
    createUser(input: $input) {
      id_user
      name
    }
  }
`;

export const UPDATE_USER = gql`
  mutation UpdateUser($id_user: Int!, $input: UpdateUserInput!) {
    updateUser(id_user: $id_user, input: $input) {
      id_user
      name
      role
      photo_url
    }
  }
`;

export const DELETE_USER = gql`
  mutation DeleteUser($id_user: Int!) {
    deleteUser(id_user: $id_user) {
      id_user
      active
    }
  }
`;.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\pages\Categories.jsx
============================================
// src/pages/Categories.jsx
import { useState, useEffect } from 'react';
import { useQuery, useMutation } from '@apollo/client';
import { GET_CATEGORIES, CREATE_CATEGORY, UPDATE_CATEGORY, DELETE_CATEGORY } from '../graphql/categories';
import { Search, Plus, Edit2, Trash2, Tag, Loader2, AlertCircle, ChevronRight } from 'lucide-react';
import CategoryModal from '../components/categories/CategoryModal';
import TablePagination from '../components/ui/TablePagination';
import toast from 'react-hot-toast';

export default function Categories() {
  const [searchTerm, setSearchTerm] = useState('');
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingCategory, setEditingCategory] = useState(null);
  const [currentPage, setCurrentPage] = useState(1);
  const itemsPerPage = 12;

  const { data, loading } = useQuery(GET_CATEGORIES);
  const [createCategory, { loading: creating }] = useMutation(CREATE_CATEGORY, { refetchQueries: [{ query: GET_CATEGORIES }] });
  const [updateCategory, { loading: updating }] = useMutation(UPDATE_CATEGORY, { refetchQueries: [{ query: GET_CATEGORIES }] });
  const [deleteCategory] = useMutation(DELETE_CATEGORY, { refetchQueries: [{ query: GET_CATEGORIES }] });

  const filteredCategories = data?.categories?.filter(cat => 
    cat.name.toLowerCase().includes(searchTerm.toLowerCase())
  ) || [];

  useEffect(() => { setCurrentPage(1); }, [searchTerm]);

  const indexOfLastItem = currentPage * itemsPerPage;
  const currentItems = filteredCategories.slice(indexOfLastItem - itemsPerPage, indexOfLastItem);

  const handleSave = async (formData) => {
    try {
      if (editingCategory) {
        await updateCategory({ variables: { id_category: editingCategory.id_category, name: formData.name } });
        toast.success('Actualizado');
      } else {
        await createCategory({ variables: { name: formData.name } });
        toast.success('Creado');
      }
      setIsModalOpen(false);
    } catch (err) { toast.error(err.message); }
  };

  if (loading) return <div className="flex justify-center p-20"><Loader2 className="animate-spin text-blue-600 h-10 w-10" /></div>;

  return (
    <div className="pb-20 px-2 md:px-0">
      
      {/* HEADER ESTANDARIZADO */}
      <div className="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-8 text-left">
        <div>
          <h1 className="text-2xl md:text-3xl font-black text-gray-800 flex items-center">
            <Tag className="mr-3 text-blue-600" size={28} /> Categor√≠as
          </h1>
          <p className="text-gray-500 text-sm mt-1">Clasifica tus productos para una mejor gesti√≥n.</p>
        </div>
        <button onClick={() => { setEditingCategory(null); setIsModalOpen(true); }} className="w-full md:w-auto bg-blue-600 text-white px-6 py-3.5 rounded-2xl font-black shadow-lg shadow-blue-100 flex items-center justify-center active:scale-95 transition-all">
          <Plus className="mr-2 h-5 w-5" /> Nueva Categor√≠a
        </button>
      </div>

      <div className="relative mb-6">
        <Search className="absolute left-4 top-3.5 text-gray-400" size={20} />
        <input
          type="text" placeholder="Buscar categor√≠a..."
          value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)}
          className="w-full pl-12 pr-4 py-3.5 bg-white border border-gray-100 rounded-2xl shadow-sm focus:ring-2 focus:ring-blue-500 outline-none font-medium"
        />
      </div>

      {/* CUADR√çCULA DE CATEGOR√çAS */}
      <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        {currentItems.map((cat) => (
          <div key={cat.id_category} className="bg-white p-5 rounded-[2rem] shadow-sm border border-gray-100 flex flex-col justify-between items-center text-center group hover:border-blue-200 transition-all">
            <div className="h-14 w-14 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center mb-3 group-hover:scale-110 transition-transform">
                <span className="text-xl font-black">{cat.name.charAt(0)}</span>
            </div>
            <h3 className="font-bold text-gray-800 text-sm leading-tight mb-4">{cat.name}</h3>
            
            <div className="flex gap-2 w-full pt-4 border-t border-gray-50">
                <button onClick={() => { setEditingCategory(cat); setIsModalOpen(true); }} className="flex-1 p-2 bg-blue-50 text-blue-600 rounded-xl active:scale-90 transition-all flex justify-center">
                    <Edit2 size={16} />
                </button>
                <button onClick={() => { if(confirm('¬øBorrar?')) deleteCategory({variables:{id_category: cat.id_category}}) }} className="flex-1 p-2 bg-red-50 text-red-500 rounded-xl active:scale-90 transition-all flex justify-center">
                    <Trash2 size={16} />
                </button>
            </div>
          </div>
        ))}
      </div>

      <TablePagination currentPage={currentPage} totalItems={filteredCategories.length} itemsPerPage={itemsPerPage} onPageChange={setCurrentPage} />

      <CategoryModal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)} categoryToEdit={editingCategory} onSave={handleSave} isSaving={false} />
    </div>
  );
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\pages\Dashboard.jsx
============================================
// src/pages/Dashboard.jsx
import { useQuery } from '@apollo/client';
import { GET_DASHBOARD_STATS } from '../graphql/reports';
import { useAuth } from '../context/AuthContext';
import { Loader2, TrendingUp, Package, ShoppingBag, UserCheck, Globe } from 'lucide-react';

// üëá Importar el nuevo componente
import AdminDashboard from '../components/dashboard/AdminDashboard';

export default function Dashboard() {
  const { user } = useAuth();
  const { data, loading, error } = useQuery(GET_DASHBOARD_STATS, { 
      pollInterval: 30000, 
      fetchPolicy: 'network-only' 
  });

  if (loading) return <div className="flex justify-center p-20"><Loader2 className="animate-spin text-blue-600 h-10 w-10" /></div>;
  if (error) return <div className="text-red-500 text-center p-10">Error cargando panel.</div>;

  const { exchangeRate, activeProductsCount, totalItemsSold } = data.dashboardStats;
  const isSeller = user.role === 'seller';
  const isAdmin = user.role === 'admin'; // Verificar si es admin

  return (
    <div className="space-y-6 pb-20 px-2 md:px-0">
      
      {/* 1. HEADER SUGERENTE */}
      <div className="text-left border-l-4 border-blue-600 pl-4 py-1">
          <h1 className="text-2xl md:text-3xl font-black text-gray-800 tracking-tight">
              {isSeller ? `¬°A vender, ${user.name.split(' ')[0]}!` : 'Ecosistema Comercial'}
          </h1>
          <p className="text-gray-400 text-sm font-medium">
              Control de Par√°metros y Rendimiento Operativo
          </p>
      </div>

      {/* 2. TARJETAS RESUMEN (Color corregido y Layout) */}
      <div className="grid grid-cols-2 md:grid-cols-3 gap-3 md:gap-6">
        
        {/* Tasa del D√≠a */}
        <div className="col-span-2 md:col-span-1 bg-white p-5 rounded-[2rem] border border-gray-100 shadow-sm relative overflow-hidden group">
           <div className="z-10 relative">
              <span className="text-[10px] font-black text-blue-600 uppercase tracking-widest bg-blue-50 px-2 py-1 rounded-lg">Tasa de Mercado</span>
              <div className="mt-4 flex items-baseline gap-1">
                <span className="text-4xl font-black text-gray-800">${exchangeRate}</span>
                <span className="text-xs font-bold text-gray-400">CUP</span>
              </div>
           </div>
           <TrendingUp className="absolute -right-4 -bottom-4 h-24 w-24 text-gray-50 opacity-50" />
        </div>

        {/* Ventas */}
        <div className="bg-gradient-to-br from-blue-600 to-indigo-700 p-5 rounded-[2rem] shadow-lg shadow-blue-100 text-white relative overflow-hidden">
           <div className="z-10 relative">
              <ShoppingBag size={20} className="mb-3" />
              <p className="text-[10px] font-bold uppercase opacity-80">Unidades Vendidas</p>
              <p className="text-3xl font-black">{totalItemsSold}</p>
           </div>
           <div className="absolute top-0 right-0 p-4 opacity-10"><ShoppingBag size={60} /></div>
        </div>

        {/* Stock - COLOR CAMBIADO DE NEGRO A √çNDIGO SUAVE */}
        <div className="bg-gradient-to-br from-indigo-500 to-purple-600 p-5 rounded-[2rem] shadow-lg shadow-purple-100 text-white relative overflow-hidden">
           <div className="z-10 relative">
              <Package size={20} className="mb-3" />
              <p className="text-[10px] font-bold uppercase opacity-80">Stock en Cat√°logo</p>
              <p className="text-3xl font-black">{activeProductsCount}</p>
           </div>
           <div className="absolute top-0 right-0 p-4 opacity-10"><Package size={60} /></div>
        </div>
      </div>

      {isAdmin && (
         <div className="mt-10">
            <h2 className="text-lg font-black text-gray-800 mb-6 flex items-center gap-2">
               <TrendingUp className="text-blue-600"/> An√°lisis de Crecimiento
            </h2>
            <AdminDashboard />
         </div>
      )}
    </div>
  );
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\pages\Inventory.jsx
============================================
// src/pages/Inventory.jsx
import { useState } from 'react';
import { useQuery, useMutation } from '@apollo/client';
import { useAuth } from '../context/AuthContext'; // <--- ESTA ERA LA IMPORTACI√ìN FALTANTE

// Queries y Mutaciones
import { 
  GET_PRODUCTS, 
  UPDATE_PRODUCT, 
  CREATE_PRODUCT, 
  ASSIGN_PRODUCT, 
  GET_SELLER_PRODUCTS, 
  RETURN_PRODUCT_FROM_SELLER 
} from '../graphql/products';
import { GET_CATEGORIES } from '../graphql/categories';
import { GET_USERS } from '../graphql/users';

// UI e Iconos
import { 
  Search, Plus, Loader2, PackageOpen, Users, 
  RefreshCw, Tag, ChevronRight, Filter 
} from 'lucide-react';
import ProductCard from '../components/products/ProductCard';
import ProductModal from '../components/products/ProductModal';
import AssignmentModal from '../components/products/AssignmentModal';
import toast from 'react-hot-toast';
import clsx from 'clsx';

export default function Inventory() {
  const { user } = useAuth();
  
  // Estados de control
  const [viewMode, setViewMode] = useState('active'); 
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedCategory, setSelectedCategory] = useState('all');
  const [selectedSeller, setSelectedSeller] = useState('');

  // Estados de Modales
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingProduct, setEditingProduct] = useState(null);
  const [isAssignModalOpen, setIsAssignModalOpen] = useState(false);
  const [productToAssign, setProductToAssign] = useState(null);

  // --- QUERIES ---
  const { data: productsData, loading: loadingProds, refetch: refetchProds } = useQuery(GET_PRODUCTS, {
    variables: { active: viewMode === 'active' },
    skip: viewMode === 'sellers',
    fetchPolicy: 'network-only'
  });

  const { data: categoriesData } = useQuery(GET_CATEGORIES);
  const { data: usersData } = useQuery(GET_USERS);
  const sellersList = usersData?.users?.filter(u => u.role === 'seller' && u.active) || [];

  const { data: sellerStockData, loading: loadingSellerStock, refetch: refetchSellerStock } = useQuery(GET_SELLER_PRODUCTS, {
    variables: { sellerId: parseInt(selectedSeller) },
    skip: viewMode !== 'sellers' || !selectedSeller,
    fetchPolicy: 'network-only'
  });

  // --- MUTACIONES ---
  const [createProduct, { loading: creating }] = useMutation(CREATE_PRODUCT, { onCompleted: () => refetchProds() });
  const [updateProduct, { loading: updating }] = useMutation(UPDATE_PRODUCT, { onCompleted: () => refetchProds() });
  const [assignProduct, { loading: assigning }] = useMutation(ASSIGN_PRODUCT);
  const [returnProduct] = useMutation(RETURN_PRODUCT_FROM_SELLER);

  // --- FILTRADO ---
  const filteredGlobalProducts = productsData?.products?.filter(p => {
    const matchesSearch = p.name.toLowerCase().includes(searchTerm.toLowerCase());
    const matchesCategory = selectedCategory === 'all' || 
                            p.product_categories.some(pc => pc.category.id_category === parseInt(selectedCategory));
    return matchesSearch && matchesCategory;
  }) || [];

  const filteredSellerStock = sellerStockData?.sellerProducts?.filter(item => {
     return item.product.name.toLowerCase().includes(searchTerm.toLowerCase());
  }) || [];

  // --- HANDLERS ---
  const handleOpenCreate = () => { setEditingProduct(null); setIsModalOpen(true); };
  const handleOpenEdit = (product) => { setEditingProduct(product); setIsModalOpen(true); };
  const handleOpenAssign = (product) => { setProductToAssign(product); setIsAssignModalOpen(true); };

  const handleSave = async (formData) => {
    try {
      const inputData = {
          name: formData.name,
          description: formData.description,
          stock: formData.stock,
          purchase_price: formData.purchase_price,
          sale_price: formData.sale_price,
          photo_url: formData.photo_url,
          warranty: formData.warranty,
          active: true,
          categoryIds: formData.categoryIds 
      };

      if (editingProduct) {
        await updateProduct({ variables: { id_product: editingProduct.id_product, input: inputData } });
        toast.success('Actualizado');
      } else {
        await createProduct({ variables: { input: inputData } });
        toast.success('Creado');
      }
      setIsModalOpen(false);
    } catch (err) { toast.error(err.message); }
  };

  const handleAssign = async (data) => {
    try {
        await assignProduct({
            variables: {
                sellerId: parseInt(data.sellerId),
                productId: productToAssign.id_product,
                quantity: parseInt(data.quantity)
            }
        });
        toast.success("Asignado correctamente");
        setIsAssignModalOpen(false);
    } catch (e) { toast.error(e.message); }
  };

  const handleReturnStock = async (item) => {
  // 1. Preguntamos la cantidad (√∫til para devoluciones parciales)
  const qtyStr = prompt(
    `¬øCu√°ntos "${item.product.name}" deseas devolver al almac√©n?\n(Disponible con vendedor: ${item.quantity})`, 
    item.quantity
  );
  
  if (!qtyStr) return; // Si cancela el prompt
  const qty = parseInt(qtyStr);

  // Validaciones b√°sicas
  if (isNaN(qty) || qty <= 0 || qty > item.quantity) {
      toast.error("Cantidad no v√°lida");
      return;
  }

  try {
      await returnProduct({
          variables: {
              sellerId: parseInt(selectedSeller), // Usamos el ID del vendedor seleccionado arriba
              productId: item.product.id_product,
              quantity: qty
          }
      });
      
      toast.success("Mercanc√≠a devuelta al almac√©n");
      
      // 2. Refrescamos ambas listas para que los n√∫meros cuadren al instante
      refetchSellerStock(); 
      refetchProds();
  } catch (e) {
      toast.error(e.message);
  }
};

  return (
    <div className="pb-24 px-2 md:px-0 relative">
       
      {/* 1. HEADER */}
       <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
          <div className="text-left">
            <h1 className="text-2xl md:text-3xl font-bold text-gray-800 flex items-center">
                <PackageOpen className="mr-3 text-blue-600" size={28} /> Inventario
            </h1>
            <p className="text-gray-500 text-sm mt-1">Control global de mercanc√≠a y stock.</p>
          </div>
          <button 
            onClick={handleOpenCreate} 
            className="hidden md:flex bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-2xl font-bold shadow-lg shadow-blue-100 items-center transition-all active:scale-95"
          >
            <Plus className="mr-2 h-5 w-5" /> Nuevo Producto
          </button>
       </div>

       {/* 2. BARRA DE CONTROL (YA NO ES STICKY) */}
       <div className="mb-6 space-y-3 bg-white p-4 rounded-3xl shadow-sm border border-gray-100">
             
             {/* Pesta√±as de Modo */}
             <div className="flex p-1 bg-gray-100 rounded-2xl overflow-x-auto no-scrollbar">
                {[
                    {id: 'active', label: 'Almac√©n', color: 'blue'},
                    {id: 'sellers', label: 'Vendedores', color: 'purple'},
                    {id: 'inactive', label: 'Papelera', color: 'red'}
                ].map(tab => (
                    <button 
                        key={tab.id}
                        onClick={() => setViewMode(tab.id)} 
                        className={clsx(
                            "flex-1 px-4 py-2.5 text-[11px] font-black uppercase tracking-widest rounded-xl transition-all whitespace-nowrap",
                            viewMode === tab.id 
                                ? `bg-white text-${tab.id === 'active' ? 'blue' : tab.id === 'sellers' ? 'purple' : 'red'}-600 shadow-sm` 
                                : "text-gray-400"
                        )}
                    >
                        {tab.label}
                    </button>
                ))}
             </div>

             {/* Buscador */}
             <div className="relative">
                <Search className="absolute left-3 top-3 text-gray-400" size={20} />
                <input 
                  type="text" 
                  placeholder="Buscar producto..."
                  value={searchTerm}
                  onChange={e => setSearchTerm(e.target.value)}
                  className="w-full pl-10 pr-4 py-2.5 bg-gray-50 border-none rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none text-sm font-medium"
                />
             </div>

             {/* Chips de Categor√≠a */}
             {viewMode !== 'sellers' && (
                 <div className="flex gap-2 overflow-x-auto no-scrollbar py-1">
                    <button 
                        onClick={() => setSelectedCategory('all')}
                        className={clsx(
                            "px-4 py-1.5 rounded-full text-[10px] font-black uppercase whitespace-nowrap transition-all border",
                            selectedCategory === 'all' ? "bg-blue-600 border-blue-600 text-white" : "bg-white border-gray-200 text-gray-400"
                        )}
                    >
                        Todos
                    </button>
                    {categoriesData?.categories?.map(cat => (
                        <button 
                            key={cat.id_category}
                            onClick={() => setSelectedCategory(cat.id_category)}
                            className={clsx(
                                "px-4 py-1.5 rounded-full text-[10px] font-black uppercase whitespace-nowrap transition-all border",
                                selectedCategory === cat.id_category ? "bg-blue-600 border-blue-600 text-white" : "bg-white border-gray-200 text-gray-400"
                            )}
                        >
                            {cat.name}
                        </button>
                    ))}
                 </div>
             )}

             {/* Selector de Vendedor */}
             {viewMode === 'sellers' && (
                <select 
                    value={selectedSeller}
                    onChange={(e) => setSelectedSeller(e.target.value)}
                    className="w-full px-4 py-2.5 bg-purple-50 text-purple-700 font-bold rounded-2xl border-none text-xs outline-none focus:ring-2 focus:ring-purple-500"
                >
                    <option value="">-- Seleccionar Vendedor --</option>
                    {sellersList.map(s => <option key={s.id_user} value={s.id_user}>{s.name}</option>)}
                </select>
             )}
       </div>

       {/* LISTADO */}
       <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 md:gap-6 mt-4">
            {viewMode !== 'sellers' ? (
                loadingProds ? <div className="col-span-full flex justify-center py-20"><Loader2 className="animate-spin text-blue-500 h-10 w-10"/></div> :
                filteredGlobalProducts.map(p => (
                    <ProductCard 
                        key={p.id_product} 
                        product={p} 
                        onEdit={handleOpenEdit} 
                        onDelete={(p) => updateProduct({variables: {id_product: p.id_product, input: {active: false}}})} 
                        onReactivate={(p) => updateProduct({variables: {id_product: p.id_product, input: {active: true, stock: 1}}})}
                        onAssign={(user?.role === 'admin' || user?.role === 'storekeeper') ? handleOpenAssign : undefined}
                        isInactiveView={viewMode === 'inactive'}
                    />
                ))
            ) : (
                <div className="col-span-full space-y-3">
                    {!selectedSeller ? (
                        <div className="text-center py-20 text-gray-300">
                            <Users size={48} className="mx-auto mb-2 opacity-20" />
                            <p className="font-bold text-sm">Selecciona un vendedor arriba</p>
                        </div>
                    ) : filteredSellerStock.map(item => (
                        <div key={item.id_seller_product} className="bg-white p-3 rounded-2xl border border-gray-100 flex items-center justify-between shadow-sm">
                            <div className="flex items-center gap-3">
                                <div className="h-12 w-12 bg-gray-100 rounded-xl overflow-hidden">
                                    {item.product.photo_url && <img src={item.product.photo_url} className="w-full h-full object-cover"/>}
                                </div>
                                <div>
                                    <h4 className="font-bold text-gray-800 text-sm">{item.product.name}</h4>
                                    <span className="text-[10px] font-black text-purple-600 bg-purple-50 px-2 py-0.5 rounded-lg">STOCK: {item.quantity}</span>
                                </div>
                            </div>
                            <button 
                               onClick={() => handleReturnStock(item)}
                                className="p-3 bg-gray-50 text-gray-400 hover:text-red-500 rounded-xl transition-colors"
                            >
                                <RefreshCw size={20} />
                            </button>
                        </div>
                    ))}
                </div>
            )}
       </div>

       {/* FAB PARA M√ìVIL */}
       {viewMode !== 'sellers' && (
           <button 
             onClick={handleOpenCreate}
             className="md:hidden fixed bottom-6 right-6 w-16 h-16 bg-blue-600 text-white rounded-full shadow-2xl flex items-center justify-center active:scale-90 transition-transform z-30"
           >
              <Plus size={32} />
           </button>
       )}

       <ProductModal 
          isOpen={isModalOpen} 
          onClose={() => setIsModalOpen(false)} 
          productToEdit={editingProduct} 
          categories={categoriesData?.categories || []} 
          onSave={handleSave} 
          isSaving={creating || updating}
       />

       <AssignmentModal 
         isOpen={isAssignModalOpen} 
         onClose={() => setIsAssignModalOpen(false)} 
         product={productToAssign} 
         onAssign={handleAssign} 
         isAssigning={assigning}
       />
    </div>
  );
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\pages\Login.jsx
============================================
// src/pages/Login.jsx
import { useForm } from 'react-hook-form';
import { useMutation } from '@apollo/client';
import { LOGIN_MUTATION } from '../graphql/auth';
import { useAuth } from '../context/AuthContext';
import { useNavigate } from 'react-router-dom';
import { useQuery } from '@apollo/client';
import toast from 'react-hot-toast';
import { Loader2, Lock, Phone, ShoppingCart } from 'lucide-react';
import { GET_CONFIG } from '../graphql/configuration';

export default function Login() {
  const { register, handleSubmit, formState: { errors } } = useForm();
  const [loginMutation, { loading }] = useMutation(LOGIN_MUTATION);
  const { login } = useAuth();
  const navigate = useNavigate();
const { data: configData } = useQuery(GET_CONFIG);
 const systemLogo = configData?.systemConfiguration?.logo_url;

 const logoPlaceholder = "https://res.cloudinary.com/ddnqbgqfn/image/upload/v1769537581/habana_express_store/img-1769548374002-829424593-logo.png";

  const onSubmit = async (data) => {
    try {
      const { data: response } = await loginMutation({
        variables: { phone: data.phone, password: data.password }
      });
      const { token, user } = response.login;
      login(token, user);
      toast.success(`¬°Hola de nuevo, ${user.name}!`);
      navigate('/'); 
    } catch (error) { toast.error(error.message); }
  };

  return (
    <div className="min-h-screen bg-white flex flex-col justify-center py-12 px-4 sm:px-6 lg:px-8 relative overflow-hidden">
      
      {/* Decoraci√≥n de fondo suave */}
      <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-600 to-indigo-600"></div>
      
      <div className="sm:mx-auto sm:w-full sm:max-w-md relative z-10">
        {/* ESPACIO PARA EL LOGO (Pr√≥ximamente din√°mico) */}
         <div className="mx-auto h-36 w-36 bg-white rounded-full flex items-center justify-center shadow-2xl shadow-blue-100 border border-gray-50 p-4 transform hover:rotate-3 transition-transform duration-500">
            <img 
              src={systemLogo || logoPlaceholder} 
              alt="Habana Express Logo" 
              className="w-full h-full object-contain"
            />
        </div>

        <h2 className="mt-8 text-center text-3xl font-black text-gray-900 tracking-tight">
          Habana<span className="text-blue-600">Express</span>
        </h2>
        <p className="mt-2 text-center text-xs font-bold text-gray-400 uppercase tracking-widest">
          Productos Internacionales en tu mano
        </p>
      </div>

      <div className="mt-10 sm:mx-auto sm:w-full sm:max-w-md">
        <div className="space-y-6">
          <form className="space-y-5" onSubmit={handleSubmit(onSubmit)}>
            
            <div className="space-y-1">
              <div className="relative">
                <div className="absolute inset-y-0 left-0 pl-5 flex items-center pointer-events-none">
                  <Phone className="h-5 w-5 text-gray-300" />
                </div>
                <input
                  type="text"
                  {...register("phone", { required: "N√∫mero requerido" })}
                  className="block w-full pl-14 pr-6 py-4 bg-gray-50 border-none rounded-full text-gray-900 font-bold placeholder-gray-300 focus:ring-2 focus:ring-blue-500 transition-all outline-none"
                  placeholder="N√∫mero de Tel√©fono"
                />
              </div>
              {errors.phone && <p className="ml-6 text-[10px] font-black text-red-500 uppercase">{errors.phone.message}</p>}
            </div>

            <div className="space-y-1">
              <div className="relative">
                <div className="absolute inset-y-0 left-0 pl-5 flex items-center pointer-events-none">
                  <Lock className="h-5 w-5 text-gray-300" />
                </div>
                <input
                  type="password"
                  {...register("password", { required: "Contrase√±a requerida" })}
                  className="block w-full pl-14 pr-6 py-4 bg-gray-50 border-none rounded-full text-gray-900 font-bold placeholder-gray-300 focus:ring-2 focus:ring-blue-500 transition-all outline-none"
                  placeholder="Contrase√±a"
                />
              </div>
              {errors.password && <p className="ml-6 text-[10px] font-black text-red-500 uppercase">{errors.password.message}</p>}
            </div>

            <div className="pt-2">
              <button
                type="submit"
                disabled={loading}
                className="w-full flex justify-center py-4 px-4 border border-transparent rounded-full shadow-xl shadow-blue-100 text-sm font-black text-white bg-blue-600 hover:bg-blue-700 active:scale-95 transition-all disabled:opacity-50"
              >
                {loading ? <Loader2 className="animate-spin h-5 w-5" /> : "LOGIN"}
              </button>
            </div>
          </form>

          <p className="text-center text-[10px] font-bold text-gray-300 uppercase tracking-widest mt-8">
            Habana Express Store ¬© 2026
          </p>
        </div>
      </div>
    </div>
  );
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\pages\POS.jsx
============================================
// src/pages/POS.jsx
import { useState, useMemo } from 'react';
import { useQuery, useMutation } from '@apollo/client';
import { useAuth } from '../context/AuthContext';
import { GET_SELLER_PRODUCTS } from '../graphql/products';
import { GET_CONFIG } from '../graphql/configuration';
import { CREATE_SALE } from '../graphql/sales';
import { Search, ShoppingCart, Trash2, Plus, Minus, Loader2, Package, AlertCircle, ChevronUp } from 'lucide-react';
import toast from 'react-hot-toast';

// Importar el nuevo componente m√≥vil
import MobileCartSheet from '../components/sales/MobileCartSheet';

export default function POS() {
  const { user } = useAuth();
  
  // --- SEGURIDAD ---
  if (user.role === 'admin') {
      return (
          <div className="flex flex-col items-center justify-center h-full text-gray-500 p-6 text-center">
              <AlertCircle className="h-16 w-16 mb-4 text-red-400" />
              <h2 className="text-xl font-bold">Modo Administrador</h2>
              <p>El POS est√° optimizado para Vendedores.</p>
          </div>
      );
  }

  // --- ESTADOS ---
  const [searchTerm, setSearchTerm] = useState('');
  const [cart, setCart] = useState([]);
  const [buyerPhone, setBuyerPhone] = useState('');
  const [paymentMethod, setPaymentMethod] = useState('cash');
  const [isMobileCartOpen, setIsMobileCartOpen] = useState(false); // Estado para el modal m√≥vil

  // --- QUERIES ---
  const { data: configData } = useQuery(GET_CONFIG);
  const config = configData?.systemConfiguration?.[0];
  const exchangeRate = config?.default_exchange_rate || 1;
  const commissionPct = config?.seller_commission_percentage || 0;

  const { data: sellerProds, loading, refetch } = useQuery(GET_SELLER_PRODUCTS, {
    variables: { sellerId: parseInt(user.id_user) },
    fetchPolicy: 'network-only'
  });

  const [createSale, { loading: processing }] = useMutation(CREATE_SALE, {
     onCompleted: () => { refetch(); }
  });

  // --- FILTRADO ---
  const availableProducts = useMemo(() => {
      const rawList = sellerProds?.sellerProducts
          ?.filter(sp => sp.quantity > 0) 
          .map(sp => ({
              id: sp.product.id_product,
              name: sp.product.name,
              price: sp.product.sale_price, // Precio ya viene en CUP o USD seg√∫n tu l√≥gica, asumo CUP final
              stock: sp.quantity,
              photo: sp.product.photo_url
          })) || [];

      return rawList.filter(p => p.name.toLowerCase().includes(searchTerm.toLowerCase()));
  }, [sellerProds, searchTerm]);

// --- LOGICA CARRITO CORREGIDA ---
  const addToCart = (product) => {
    // 1. Buscamos si ya existe usando el estado actual 'cart' (fuera del setter)
    const existingItem = cart.find(item => item.id === product.id);

    // CASO A: El producto YA est√° en el carrito
    if (existingItem) {
        // Verificamos el stock ANTES de intentar actualizar
        if (existingItem.qty >= product.stock) {
            // Toast fuera del setter -> Se ejecuta una sola vez
            toast.error("L√≠mite de stock alcanzado", { id: 'stock-limit' }); 
            return; // No hacemos nada m√°s
        }
        
        // Si hay stock, actualizamos el estado limpiamente
        setCart(prev => prev.map(item => 
            item.id === product.id ? { ...item, qty: item.qty + 1 } : item
        ));
    } 
    
    // CASO B: Es un producto NUEVO
    else {
        // Toast fuera del setter -> Se ejecuta una sola vez
        toast.success("Agregado al carrito", { 
            duration: 1000, 
            position: 'bottom-center',
            id: 'added-cart' // id opcional para evitar duplicados r√°pidos
        });
        
        // Actualizamos estado
        setCart(prev => [...prev, { ...product, qty: 1 }]);
    }
  };

  const updateQty = (id, delta) => {
      setCart(prev => prev.map(item => {
          if (item.id === id) {
              const newQty = item.qty + delta;
              if (newQty > item.stock) {
                  toast.error("Stock insuficiente");
                  return item;
              }
              return newQty > 0 ? { ...item, qty: newQty } : item;
          }
          return item;
      }));
  };

  const removeFromCart = (id) => setCart(prev => prev.filter(item => item.id !== id));

  const totalCUP = cart.reduce((acc, item) => acc + (item.price * item.qty), 0);
  const estimatedCommission = totalCUP * (commissionPct / 100);

  const handleCheckout = async () => {
      if (cart.length === 0) return toast.error("Carrito vac√≠o");
      if (!buyerPhone) return toast.error("Ingresa el tel√©fono del cliente");

      try {
          await createSale({
              variables: {
                  sellerId: parseInt(user.id_user),
                  exchange_rate: parseFloat(exchangeRate),
                  total_cup: totalCUP,
                  buyer_phone: buyerPhone,
                  payment_method: paymentMethod,
                  notes: "Venta POS",
                  items: cart.map(i => ({ productId: i.id, quantity: i.qty }))
              }
          });
          toast.success("¬°Venta Exitosa!");
          setCart([]);
          setBuyerPhone('');
          setIsMobileCartOpen(false); // Cerrar modal m√≥vil si estaba abierto
      } catch (err) {
          toast.error(err.message);
      }
  };

  // --- RENDER ---
  return (
    <div className="flex flex-col h-full md:flex-row gap-4 pb-20 md:pb-0 relative">
       
       {/* 1. SECCI√ìN PRODUCTOS (Izquierda / Full Mobile) */}
       <div className="flex-1 bg-white rounded-none md:rounded-2xl shadow-none md:shadow-sm border-x-0 md:border border-gray-100 flex flex-col overflow-hidden h-full">
          
          {/* Header Sticky */}
          <div className="sticky top-0 z-10 bg-white p-4 border-b border-gray-100 shadow-sm">
             <div className="flex justify-between items-center mb-3">
                 <h2 className="font-bold text-gray-800 text-lg">Cat√°logo</h2>
                 <span className="bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-xs font-bold border border-blue-100">
                    Tasa: ${exchangeRate}
                 </span>
             </div>
             
             {/* Buscador optimizado para dedos */}
             <div className="relative">
                <Search className="absolute left-3 top-3.5 text-gray-400 h-5 w-5" />
                <input 
                    type="text" placeholder=" Buscar producto..." 
                    className="w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none text-base"
                    value={searchTerm} onChange={e => setSearchTerm(e.target.value)}
                />
             </div>
          </div>

          {/* Grid de Productos */}
          <div className="flex-1 overflow-y-auto p-3 bg-gray-50/30">
             {loading ? <Loader2 className="animate-spin mx-auto mt-10 text-blue-500"/> : 
              availableProducts.length === 0 ? <div className="text-center mt-10 text-gray-400">No hay productos.</div> :
              
              /* GRID RESPONSIVE: 2 columnas en m√≥vil, m√°s en escritorio */
              <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 pb-24 md:pb-0">
                 {availableProducts.map(prod => (
                    <div 
                        key={prod.id} 
                        onClick={() => addToCart(prod)} 
                        className="bg-white p-2 rounded-xl border border-gray-100 shadow-sm hover:border-blue-300 active:scale-95 transition-all cursor-pointer flex flex-col h-full"
                    >
                       <div className="aspect-square bg-gray-100 rounded-lg mb-2 relative overflow-hidden">
                           {prod.photo ? (
                               <img src={prod.photo} className="w-full h-full object-cover"/>
                           ) : (
                               <Package className="absolute inset-0 m-auto text-gray-300 h-8 w-8"/>
                           )}
                           {/* Badge de Stock */}
                           <span className="absolute bottom-1 right-1 bg-black/70 text-white text-[10px] font-bold px-1.5 py-0.5 rounded backdrop-blur-sm">
                              Stock: {prod.stock}
                           </span>
                       </div>
                       
                       <h3 className="font-semibold text-gray-800 text-xs sm:text-sm line-clamp-2 leading-tight flex-1">
                          {prod.name}
                       </h3>
                       
                       <div className="mt-2 pt-2 border-t border-gray-50 flex justify-between items-center">
                          <p className="text-blue-600 font-extrabold text-sm sm:text-base">${prod.price}</p>
                          <div className="bg-blue-50 text-blue-600 p-1 rounded-full">
                              <Plus size={14} />
                          </div>
                       </div>
                    </div>
                 ))}
              </div>
             }
          </div>
       </div>

       {/* 2. SECCI√ìN TICKET DESKTOP (Oculto en m√≥vil) */}
       <div className="hidden md:flex w-80 bg-white rounded-2xl shadow-xl border border-gray-100 flex-col h-[calc(100vh-6rem)] sticky top-4">
           {/* ... (Este es el mismo c√≥digo de escritorio que ya ten√≠as, no cambia mucho) ... */}
           <div className="p-4 bg-blue-600 text-white rounded-t-2xl font-bold flex items-center shadow-md">
               <ShoppingCart className="mr-2 h-5 w-5"/> Ticket de Venta
           </div>
           
           <div className="flex-1 overflow-y-auto p-4 space-y-2 bg-gray-50/50">
               {cart.length === 0 && <p className="text-center text-gray-400 text-sm mt-4">Carrito vac√≠o</p>}
               {cart.map(item => (
                   <div key={item.id} className="flex justify-between items-center bg-white border border-gray-100 p-2 rounded-lg text-sm shadow-sm">
                       <div className="flex-1 min-w-0 pr-2">
                           <div className="font-bold truncate text-gray-800">{item.name}</div>
                           <div className="text-blue-600 text-xs font-medium">${item.price * item.qty}</div>
                       </div>
                       <div className="flex items-center gap-1 bg-gray-100 rounded-lg p-0.5">
                           <button onClick={() => updateQty(item.id, -1)} className="p-1 hover:bg-white rounded transition"><Minus size={12}/></button>
                           <span className="w-5 text-center font-bold text-xs">{item.qty}</span>
                           <button onClick={() => updateQty(item.id, 1)} className="p-1 hover:bg-white rounded transition"><Plus size={12}/></button>
                       </div>
                       <button onClick={() => removeFromCart(item.id)} className="text-red-400 hover:text-red-600 ml-2 p-1"><Trash2 size={14}/></button>
                   </div>
               ))}
           </div>

           <div className="p-4 bg-white border-t space-y-3 rounded-b-2xl shadow-[0_-4px_10px_rgba(0,0,0,0.05)]">
               <input type="text" placeholder="üì± Tel√©fono Cliente" className="w-full p-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-blue-500" value={buyerPhone} onChange={e => setBuyerPhone(e.target.value)} />
               
               <div className="flex gap-2 text-xs">
                   <button onClick={() => setPaymentMethod('cash')} className={`flex-1 py-2 rounded-lg border font-bold ${paymentMethod==='cash'?'bg-green-50 border-green-200 text-green-700':'bg-white text-gray-500'}`}>Efectivo</button>
                   <button onClick={() => setPaymentMethod('transfer')} className={`flex-1 py-2 rounded-lg border font-bold ${paymentMethod==='transfer'?'bg-blue-50 border-blue-200 text-blue-700':'bg-white text-gray-500'}`}>Transf.</button>
               </div>

               <div className="space-y-1 pt-2 border-t">
                   <div className="flex justify-between text-lg font-bold">
                       <span>Total:</span><span className="text-blue-600">${totalCUP.toFixed(0)}</span>
                   </div>
               </div>

               <button onClick={handleCheckout} disabled={processing || cart.length===0} className="w-full py-3 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 disabled:opacity-50 shadow-lg shadow-blue-200 transition-transform active:scale-95">
                   {processing ? <Loader2 className="animate-spin mx-auto"/> : "COBRAR"}
               </button>
           </div>
       </div>

       {/* 3. BARRA FLOTANTE M√ìVIL (Sticky Bottom) */}
       {/* Solo visible en m√≥vil y si hay items en el carrito */}
       {cart.length > 0 && (
          <div className="md:hidden fixed bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-white via-white to-transparent z-40">
              <button 
                  onClick={() => setIsMobileCartOpen(true)}
                  className="w-full bg-blue-600 text-white rounded-2xl p-4 shadow-xl flex items-center justify-between active:scale-95 transition-transform"
              >
                  <div className="flex items-center gap-2">
                      <div className="bg-white/20 px-3 py-1 rounded-lg font-bold text-sm">
                          {cart.reduce((acc, i) => acc + i.qty, 0)} √≠tems
                      </div>
                      <div className="flex flex-col items-start leading-none">
                          <span className="text-[10px] opacity-80 uppercase font-bold">Total</span>
                          <span className="text-lg font-black">${totalCUP}</span>
                      </div>
                  </div>
                  <div className="flex items-center font-bold text-sm">
                      Ver Carrito <ChevronUp className="ml-1 animate-bounce" size={16}/>
                  </div>
              </button>
          </div>
       )}

       {/* 4. MODAL COMPLETO M√ìVIL (Importado) */}
       <MobileCartSheet 
         isOpen={isMobileCartOpen}
         onClose={() => setIsMobileCartOpen(false)}
         cart={cart}
         updateQty={updateQty}
         removeFromCart={removeFromCart}
         totalCUP={totalCUP}
         estimatedCommission={estimatedCommission}
         buyerPhone={buyerPhone}
         setBuyerPhone={setBuyerPhone}
         paymentMethod={paymentMethod}
         setPaymentMethod={setPaymentMethod}
         handleCheckout={handleCheckout}
         processing={processing}
       />
    </div>
  );
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\pages\Returns.jsx
============================================
// src/pages/Returns.jsx
import { useState } from 'react';
import { useQuery, useMutation } from '@apollo/client';
import { GET_SALES, CREATE_RETURN } from '../graphql/sales';
import { Search, RotateCcw, Package, AlertTriangle, Check, X, Hash, Phone, ShoppingBag, Loader2 } from 'lucide-react';
import toast from 'react-hot-toast';

export default function Returns() {
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedSale, setSelectedSale] = useState(null);
  const [returnItem, setReturnItem] = useState(null);
  const [qty, setQty] = useState(1);
  const [reason, setReason] = useState('');
  const [returnToStock, setReturnToStock] = useState(true);

  const { data, loading } = useQuery(GET_SALES);
  const [createReturn, { loading: processing }] = useMutation(CREATE_RETURN);

  const sales = data?.sales?.filter(s => 
    s.status === 'COMPLETED' && 
    (s.id_sale.toString().includes(searchTerm) || s.buyer_phone.includes(searchTerm))
  ) || [];

  const handleProcessReturn = async () => {
      if (!reason) return toast.error("Escribe un motivo");
      try {
          await createReturn({
              variables: {
                  saleId: returnItem.saleId,
                  productId: returnItem.id_product,
                  quantity: parseInt(qty),
                  reason,
                  returnToStock
              }
          });
          toast.success("Devoluci√≥n completada");
          setReturnItem(null);
      } catch (e) { toast.error(e.message); }
  };

  return (
    <div className="pb-20 max-w-4xl mx-auto px-2 md:px-0">
      
      {/* HEADER ESTANDARIZADO */}
      <div className="text-left mb-8">
          <h1 className="text-2xl md:text-3xl font-black text-gray-800 flex items-center">
              <RotateCcw className="mr-3 text-blue-600" size={28} /> Devoluciones
          </h1>
          <p className="text-gray-500 text-sm mt-1">Reintegro de productos al inventario o registro de mermas.</p>
      </div>

      {/* BUSCADOR ESTILO MODERNO */}
      <div className="bg-white p-4 rounded-3xl shadow-sm border border-gray-100 mb-6">
          <label className="text-[10px] font-black text-gray-400 uppercase ml-4 mb-2 block">Localizar Venta</label>
          <div className="relative">
              <Search className="absolute left-4 top-3.5 text-gray-300" size={20} />
              <input 
                  type="text" 
                  placeholder="ID de venta o tel√©fono del cliente..." 
                  className="w-full pl-12 pr-4 py-3.5 bg-gray-50 border-none rounded-2xl outline-none font-bold focus:ring-2 focus:ring-blue-500 transition-all"
                  value={searchTerm}
                  onChange={e => { setSearchTerm(e.target.value); setSelectedSale(null); }}
              />
          </div>
          
          {/* Resultados R√°pidos */}
          {searchTerm && !selectedSale && (
              <div className="mt-4 space-y-2 animate-in fade-in slide-in-from-top-2">
                  {sales.slice(0, 3).map(sale => (
                      <button 
                        key={sale.id_sale} 
                        onClick={() => setSelectedSale(sale)} 
                        className="w-full p-4 bg-gray-50 rounded-2xl flex justify-between items-center hover:bg-blue-50 transition-colors group"
                      >
                          <div className="flex items-center gap-3">
                              <div className="p-2 bg-white rounded-xl shadow-sm group-hover:text-blue-600"><Hash size={16}/></div>
                              <div className="text-left">
                                  <p className="font-black text-gray-800 text-sm">Venta #{sale.id_sale}</p>
                                  <p className="text-xs text-gray-400 font-bold">{sale.buyer_phone}</p>
                              </div>
                          </div>
                          <span className="text-blue-600 font-black">${sale.total_cup}</span>
                      </button>
                  ))}
                  {sales.length === 0 && <p className="text-center text-xs text-gray-400 py-4 italic">No hay ventas completadas con ese dato.</p>}
              </div>
          )}
      </div>

      {/* DETALLE DE PRODUCTOS DE LA VENTA */}
      {selectedSale && (
          <div className="bg-white rounded-[2.5rem] shadow-xl border border-blue-50 overflow-hidden animate-in zoom-in duration-300">
              <div className="bg-blue-600 px-6 py-5 flex justify-between items-center">
                  <div className="text-white">
                      <p className="text-[10px] font-black opacity-70 uppercase">Productos de la Venta</p>
                      <h2 className="font-black text-lg">#{selectedSale.id_sale} ‚Äî {selectedSale.buyer_phone}</h2>
                  </div>
                  <button onClick={() => setSelectedSale(null)} className="p-2 bg-white/20 text-white rounded-full hover:bg-white/30"><X size={20}/></button>
              </div>
              
              <div className="p-4 grid grid-cols-1 gap-3">
                  {selectedSale.sale_products.map((item, idx) => (
                      <div key={idx} className="bg-gray-50 p-4 rounded-3xl flex items-center justify-between group">
                          <div className="flex items-center gap-4">
                              <div className="h-12 w-12 bg-white rounded-2xl flex items-center justify-center text-blue-600 shadow-sm"><Package size={20}/></div>
                              <div>
                                  <h3 className="font-bold text-gray-800 text-sm">{item.product.name}</h3>
                                  <p className="text-[10px] font-black text-gray-400 uppercase tracking-widest">Cantidad: {item.quantity}</p>
                              </div>
                          </div>
                          <button 
                              onClick={() => { setReturnItem({ ...item.product, saleId: selectedSale.id_sale }); setQty(1); setReason(''); setReturnToStock(true); }}
                              className="p-3 bg-red-600 text-white rounded-2xl shadow-lg shadow-blue-100 active:scale-90 transition-all"
                          >
                              <RotateCcw size={18}/>
                          </button>
                      </div>
                  ))}
              </div>
          </div>
      )}

      {/* MODAL DE PROCESAMIENTO (Estilo Premium con Scroll) */}
      {returnItem && (
          <div className="fixed inset-0 z-50 flex items-center justify-center p-2 bg-black/60 backdrop-blur-sm">
              <div className="bg-white rounded-[2.5rem] shadow-2xl w-full max-w-md flex flex-col max-h-[90vh] overflow-hidden animate-in zoom-in">
                  <div className="px-6 py-5 border-b border-gray-50 flex justify-between items-center">
                      <h3 className="font-black text-gray-800">Procesar Devoluci√≥n</h3>
                      <button onClick={() => setReturnItem(null)} className="p-2 bg-gray-50 rounded-full"><X size={18}/></button>
                  </div>

                  <div className="flex-1 overflow-y-auto p-6 space-y-6">
                      <div className="p-4 bg-gray-50 rounded-2xl border border-gray-100">
                          <p className="text-[10px] font-black text-gray-400 uppercase mb-1">Producto Seleccionado</p>
                          <p className="font-bold text-gray-800 text-sm">{returnItem.name}</p>
                      </div>

                      <div className="space-y-1">
                          <label className="text-[10px] font-black text-gray-400 uppercase ml-2">Cantidad a Devolver</label>
                          <input type="number" min="1" value={qty} onChange={e => setQty(e.target.value)} className="w-full p-4 bg-gray-50 border-none rounded-2xl font-black text-gray-800 outline-none focus:ring-2 focus:ring-blue-500" />
                      </div>
                      
                      <div className="space-y-1">
                          <label className="text-[10px] font-black text-gray-400 uppercase ml-2">Motivo de la Devoluci√≥n</label>
                          <textarea rows="2" value={reason} onChange={e => setReason(e.target.value)} placeholder="Ej: Defecto, cambio..." className="w-full p-4 bg-gray-50 border-none rounded-2xl outline-none resize-none" />
                      </div>

                      <div className="space-y-2">
                          <label className="text-[10px] font-black text-gray-400 uppercase ml-2">Estado tras Devoluci√≥n</label>
                          <div className="grid grid-cols-2 gap-3">
                              <button onClick={() => setReturnToStock(true)} className={`p-4 rounded-2xl border-2 flex flex-col items-center gap-2 transition-all ${returnToStock ? 'bg-green-50 border-green-500 text-green-700' : 'bg-white border-gray-100 text-gray-300'}`}>
                                  <Check size={20}/>
                                  <span className="text-[10px] font-black uppercase">√ötil (Al Stock)</span>
                              </button>
                              <button onClick={() => setReturnToStock(false)} className={`p-4 rounded-2xl border-2 flex flex-col items-center gap-2 transition-all ${!returnToStock ? 'bg-red-50 border-red-500 text-red-700' : 'bg-white border-gray-100 text-gray-300'}`}>
                                  <AlertTriangle size={20}/>
                                  <span className="text-[10px] font-black uppercase">Roto / Merma</span>
                              </button>
                          </div>
                      </div>
                  </div>

                  <div className="p-6 border-t border-gray-50 bg-gray-50/30 flex gap-3">
                      <button onClick={() => setReturnItem(null)} className="flex-1 py-4 text-gray-400 font-bold">Cancelar</button>
                      <button onClick={handleProcessReturn} disabled={processing} className="flex-[2] py-4 bg-blue-600 text-white font-black rounded-2xl shadow-lg shadow-blue-100 flex items-center justify-center gap-2">
                          {processing ? <Loader2 className="animate-spin"/> : 'CONFIRMAR'}
                      </button>
                  </div>
              </div>
          </div>
      )}
    </div>
  );
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\pages\Sales.jsx
============================================
// src/pages/Sales.jsx
import { useState, useEffect } from 'react';
import { useQuery, useMutation } from '@apollo/client';
import { GET_SALES, UPDATE_SALE, CANCEL_SALE } from '../graphql/sales';
import { Search, FileText, Edit2, Ban, Loader2, AlertCircle, Calendar, User, Phone, DollarSign, CreditCard } from 'lucide-react';
import SaleModal from '../components/sales/SaleModal';
import TablePagination from '../components/ui/TablePagination';
import toast from 'react-hot-toast';

export default function Sales() {
  const [search, setSearch] = useState('');
  const [editingSale, setEditingSale] = useState(null);
  const [currentPage, setCurrentPage] = useState(1);
  const itemsPerPage = 10;

  const { data, loading, error } = useQuery(GET_SALES, { 
    pollInterval: 10000,
    fetchPolicy: 'network-only' 
  });
  
  const [updateSale, { loading: updating }] = useMutation(UPDATE_SALE, {
     refetchQueries: [{ query: GET_SALES }]
  });
  
  const [cancelSale] = useMutation(CANCEL_SALE, {
     refetchQueries: [{ query: GET_SALES }]
  });

  const sales = data?.sales?.filter(s => 
     s.seller.name.toLowerCase().includes(search.toLowerCase()) || 
     s.buyer_phone.includes(search) ||
     s.id_sale.toString().includes(search)
  ) || [];

  useEffect(() => {
    setCurrentPage(1);
  }, [search]);

  const indexOfLastItem = currentPage * itemsPerPage;
  const indexOfFirstItem = indexOfLastItem - itemsPerPage;
  const currentSales = sales.slice(indexOfFirstItem, indexOfLastItem);

  const handleCancel = async (id) => {
      if (window.confirm("‚ö†Ô∏è ¬øANULAR esta venta? El stock volver√° al inventario.")) {
          try {
              await cancelSale({ variables: { id_sale: id } });
              toast.success("Venta anulada");
          } catch (e) {
              toast.error(e.message);
          }
      }
  };

  const handleSave = async (formData) => {
      try {
          await updateSale({
              variables: {
                  id_sale: editingSale.id_sale,
                  input: {
                      total_cup: parseFloat(formData.total_cup),
                      exchange_rate: parseFloat(formData.exchange_rate),
                      buyer_phone: formData.buyer_phone,
                      payment_method: formData.payment_method,
                      notes: formData.notes
                  }
              }
          });
          toast.success("Venta actualizada");
          setEditingSale(null);
      } catch (e) {
          toast.error(e.message);
      }
  };

  if (loading) return <div className="flex justify-center p-20"><Loader2 className="animate-spin h-10 w-10 text-blue-600"/></div>;
  
  if (error) return (
    <div className="flex flex-col items-center justify-center p-10 text-red-500">
        <AlertCircle className="h-10 w-10 mb-2"/>
        <p className="font-bold">Error cargando ventas</p>
    </div>
  );

  return (
    <div className="pb-20 max-w-7xl mx-auto px-2 md:px-0">
        
        {/* --- HEADER CORREGIDO --- */}
        <div className="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
            <div className="text-left"> {/* Aseguramos alineaci√≥n izquierda */}
                <h1 className="text-2xl md:text-3xl font-bold text-gray-800 flex items-center">
                    <FileText className="mr-3 text-blue-600" size={28}/> Historial de Ventas
                </h1>
                <p className="text-gray-500 text-sm mt-1">
                    Registro de operaciones y control de ingresos.
                </p>
            </div>
        </div>

        {/* BUSCADOR ESTILO CATEGORIAS */}
        <div className="relative mb-6">
          <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
            <Search className="h-5 w-5 text-gray-400" />
          </div>
          <input
            type="text"
            placeholder="Buscar por ID, vendedor o cliente..."
            value={search}
            onChange={(e) => setSearch(e.target.value)}
            className="w-full pl-11 pr-4 py-3 bg-white border border-gray-200 rounded-2xl shadow-sm focus:ring-2 focus:ring-blue-500 outline-none transition-all"
          />
        </div>

        {/* LISTA DE VENTAS MEJORADA */}
        <div className="space-y-4">
            {currentSales.length === 0 && (
                <div className="text-center py-12 text-gray-400 bg-white rounded-2xl border border-dashed border-gray-200">
                    <p>No se encontraron registros.</p>
                </div>
            )}

            {currentSales.map(sale => {
                const isCancelled = sale.status === 'CANCELLED';
                const date = new Date(Number(sale.sale_date));

                return (
                    <div 
                        key={sale.id_sale} 
                        className={`relative overflow-hidden bg-white rounded-2xl border transition-all duration-300 shadow-sm hover:shadow-md 
                        ${isCancelled ? 'border-red-100 bg-red-50/30' : 'border-gray-100 hover:border-blue-200'}`}
                    >
                        {/* Indicador lateral de estado */}
                        <div className={`absolute left-0 top-0 bottom-0 w-1.5 ${isCancelled ? 'bg-red-400' : 'bg-blue-500'}`}></div>

                        <div className="p-4 md:p-5 flex flex-col md:flex-row md:items-center justify-between gap-4">
                            
                            {/* Bloque 1: Identificaci√≥n y Vendedor */}
                            <div className="flex items-center gap-4">
                                <div className={`h-12 w-12 rounded-xl flex items-center justify-center font-bold flex-shrink-0 shadow-sm
                                    ${isCancelled ? 'bg-red-100 text-red-600' : 'bg-blue-50 text-blue-600'}`}>
                                    {isCancelled ? <Ban size={20}/> : <User size={20}/>}
                                </div>
                                <div>
                                    <div className="flex items-center gap-2">
                                        <span className="text-[10px] font-black text-gray-400 uppercase tracking-widest">ID #{sale.id_sale}</span>
                                        {isCancelled && (
                                            <span className="bg-red-500 text-white text-[9px] px-2 py-0.5 rounded-full font-black uppercase shadow-sm">
                                                Anulada
                                            </span>
                                        )}
                                    </div>
                                    <h3 className={`font-bold text-lg leading-tight ${isCancelled ? 'text-gray-400 line-through' : 'text-gray-800'}`}>
                                        {sale.seller.name}
                                    </h3>
                                    <div className="flex items-center gap-2 text-xs text-gray-500 mt-0.5">
                                        <Calendar size={12} />
                                        <span>{date.toLocaleDateString()}</span>
                                        <span className="text-gray-300">‚Ä¢</span>
                                        <span>{date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                                    </div>
                                </div>
                            </div>

                            {/* Bloque 2: Monto y Pago (Muy visual en m√≥vil) */}
                            <div className="flex items-center justify-between md:justify-center md:flex-col border-y md:border-y-0 py-3 md:py-0 border-gray-50">
                                <div className="text-left md:text-center">
                                    <span className="text-[10px] text-gray-400 font-bold uppercase block md:mb-1">Total Cobrado</span>
                                    <p className={`text-2xl font-black ${isCancelled ? 'text-gray-300 line-through' : 'text-blue-600'}`}>
                                        ${new Intl.NumberFormat().format(sale.total_cup)}<span className="text-xs ml-1">CUP</span>
                                    </p>
                                </div>
                                <div className="flex items-center gap-2 md:mt-1">
                                    <span className={`flex items-center gap-1 text-[10px] font-bold px-2 py-1 rounded-lg ${sale.payment_method === 'cash' ? 'bg-green-100 text-green-700' : 'bg-purple-100 text-purple-700'}`}>
                                        {sale.payment_method === 'cash' ? <DollarSign size={10}/> : <CreditCard size={10}/>}
                                        {sale.payment_method === 'cash' ? 'EFECTIVO' : 'TRANSF.'}
                                    </span>
                                </div>
                            </div>

                            {/* Bloque 3: Cliente y Acciones */}
                            <div className="flex items-center justify-between md:gap-6">
                                <div className="text-left md:text-right">
                                    <span className="text-[10px] text-gray-400 font-bold uppercase block">Cliente</span>
                                    <div className="flex items-center gap-1.5 font-mono font-bold text-gray-700">
                                        <Phone size={12} className="text-gray-400"/>
                                        {sale.buyer_phone}
                                    </div>
                                </div>

                                <div className="flex gap-2">
                                    {!isCancelled ? (
                                        <>
                                            <button 
                                                onClick={() => setEditingSale(sale)}
                                                className="p-3 text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-xl transition-all active:scale-90"
                                            >
                                                <Edit2 size={18} />
                                            </button>
                                            <button 
                                                onClick={() => handleCancel(sale.id_sale)}
                                                className="p-3 text-red-500 bg-red-50 hover:bg-red-100 rounded-xl transition-all active:scale-90"
                                            >
                                                <Ban size={18} />
                                            </button>
                                        </>
                                    ) : (
                                        <div className="px-4 py-2 bg-gray-100 text-gray-400 rounded-xl text-[10px] font-black uppercase tracking-widest">
                                            Archivo
                                        </div>
                                    )}
                                </div>
                            </div>

                        </div>
                    </div>
                );
            })}
        </div>
        
        <TablePagination 
            currentPage={currentPage}
            totalItems={sales.length}
            itemsPerPage={itemsPerPage}
            onPageChange={setCurrentPage}
        />

        <SaleModal 
            isOpen={!!editingSale}
            onClose={() => setEditingSale(null)}
            saleToEdit={editingSale}
            onSave={handleSave}
            isSaving={updating}
        />
    </div>
  );
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\pages\Settings.jsx
============================================
// src/pages/Settings.jsx
import { useState, useEffect } from 'react';
import { useForm } from 'react-hook-form';
import { useQuery, useMutation } from '@apollo/client';
import { GET_CONFIG, UPDATE_CONFIG, TRIGGER_SYNC } from '../graphql/configuration';
import toast from 'react-hot-toast';
import { 
  Settings as SettingsIcon, Save, Building, Phone, Mail, DollarSign, 
  Bot, Info, Loader2, Clock, RefreshCw, FileText, Calendar, 
  Image as ImageIcon, UploadCloud 
} from 'lucide-react';

// --- HELPERS PARA TIEMPO ---
const extractTimeFromISO = (rawDate) => {
  if (!rawDate) return '';
  try {
    const date = new Date(Number(rawDate) || rawDate);
    if (!isNaN(date.getTime())) {
      const hours = date.getHours().toString().padStart(2, '0');
      const minutes = date.getMinutes().toString().padStart(2, '0');
      return `${hours}:${minutes}`;
    }
  } catch (e) { console.error(e); }
  
  if (typeof rawDate === 'string' && rawDate.includes('T')) {
      return rawDate.split('T')[1].substring(0, 5);
  }
  return '';
};

const timeStringToISO = (timeString) => {
  if (!timeString) return null;
  const [hours, minutes] = timeString.split(':');
  const date = new Date();
  date.setHours(parseInt(hours), parseInt(minutes), 0, 0);
  return date.toISOString();
};

export default function Settings() {
  const { register, handleSubmit, setValue, watch, reset, formState: { errors } } = useForm();
  const [configId, setConfigId] = useState(null);
  const [isUploading, setIsUploading] = useState(false);
  const currentLogo = watch('logo_url');

  const { data, loading, error } = useQuery(GET_CONFIG, { fetchPolicy: 'network-only' });
  const [updateConfig, { loading: saving }] = useMutation(UPDATE_CONFIG);
  const [triggerSync, { loading: syncing }] = useMutation(TRIGGER_SYNC);

  // --- EFECTO PARA CARGAR DATOS EN LOS INPUTS ---
  useEffect(() => {
    if (data?.systemConfiguration?.[0]) {
      const config = data.systemConfiguration[0];
      setConfigId(config.id_config);
      
      // Mapeo expl√≠cito para asegurar que cada campo se llene
      reset({
        company_name: config.company_name,
        company_phone: config.company_phone,
        company_email: config.company_email,
        description: config.description,
        logo_url: config.logo_url,
        default_exchange_rate: config.default_exchange_rate,
        seller_commission_percentage: config.seller_commission_percentage,
        telegram_bot_token: config.telegram_bot_token,
        
        // Tiempos y D√≠as
        exchange_rate_sync_time: extractTimeFromISO(config.exchange_rate_sync_time),
        monthly_report_day: config.monthly_report_day,
        monthly_report_time: extractTimeFromISO(config.monthly_report_time),
        annual_report_day: config.annual_report_day,
        annual_report_time: extractTimeFromISO(config.annual_report_time),
      });
    }
  }, [data, reset]);

  const handleManualSync = async () => {
      try {
          await triggerSync();
          toast.success("Precios actualizados");
      } catch (e) { toast.error("Error al sincronizar"); }
  };

  const handleImageUpload = async (e) => {
    const file = e.target.files[0];
    if (!file) return;
    setIsUploading(true);
    const formData = new FormData();
    formData.append('file', file);
    try {
        const API_URL = import.meta.env.VITE_API_URL;
        const response = await fetch(`${API_URL}/api/upload`, { method: 'POST', body: formData });
        const resData = await response.json();
        setValue('logo_url', resData.url); 
        toast.success('Logo actualizado');
    } catch (error) { toast.error('Error al subir imagen'); }
    finally { setIsUploading(false); }
  };

  const onSubmit = async (formData) => {
    try {
      const input = {
        company_name: formData.company_name,
        company_phone: formData.company_phone,
        company_email: formData.company_email,
        description: formData.description,
        logo_url: formData.logo_url,
        telegram_bot_token: formData.telegram_bot_token,
        default_exchange_rate: parseFloat(formData.default_exchange_rate),
        seller_commission_percentage: parseFloat(formData.seller_commission_percentage),
        monthly_report_day: parseInt(formData.monthly_report_day),
        annual_report_day: parseInt(formData.annual_report_day),
        exchange_rate_sync_time: timeStringToISO(formData.exchange_rate_sync_time),
        monthly_report_time: timeStringToISO(formData.monthly_report_time),
        annual_report_time: timeStringToISO(formData.annual_report_time),
        active: true
      };
      await updateConfig({ variables: { id_config: configId, input } });
      toast.success('Configuraci√≥n guardada');
    } catch (err) { toast.error(err.message); }
  };

  if (loading) return <div className="h-96 flex items-center justify-center"><Loader2 className="animate-spin text-blue-600 h-10 w-10" /></div>;
  if (error) return <div className="p-4 bg-red-50 text-red-600 rounded-lg text-center mt-10">Error de conexi√≥n.</div>;

  return (
    <div className="max-w-4xl mx-auto pb-24 px-2 md:px-0">
      
      {/* --- HEADER --- */}
      <div className="mb-8 text-left">
        <h1 className="text-2xl md:text-3xl font-bold text-gray-800 flex items-center">
          <div className="p-2 bg-gray-100 rounded-xl mr-3">
            <SettingsIcon className="text-gray-600" size={24} />
          </div>
          Configuraci√≥n
        </h1>
        <p className="text-gray-500 text-sm mt-1 ml-14 md:ml-16">Par√°metros globales del negocio.</p>
      </div>

      <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
        
        {/* 1. IDENTIDAD */}
        <div className="bg-white rounded-3xl shadow-sm border border-gray-100 p-6">
          <div className="flex items-center gap-3 mb-6">
            <Building className="text-blue-500" size={20} />
            <h2 className="font-bold text-gray-800 uppercase text-xs tracking-wider">Identidad</h2>
          </div>
          
          <div className="flex flex-col md:flex-row gap-8 items-center md:items-start">
            <div className="relative group">
                <div className="w-40 h-40 rounded-full border-4 border-gray-50 shadow-lg overflow-hidden bg-gray-50 flex items-center justify-center">
                    {isUploading ? <Loader2 className="animate-spin text-blue-500" /> : 
                     currentLogo ? <img src={currentLogo} className="w-full h-full object-cover" /> : <ImageIcon className="text-gray-300" size={40} />}
                </div>
                <label className="absolute -bottom-2 -right-2 bg-blue-600 text-white p-2 rounded-xl shadow-lg cursor-pointer">
                    <UploadCloud size={16} /><input type="file" className="hidden" onChange={handleImageUpload} />
                </label>
            </div>

            <div className="flex-1 w-full space-y-4">
                <div className="grid grid-cols-1 gap-4">
                    <input {...register('company_name')} placeholder="Nombre Empresa" className="w-full px-4 py-3 bg-gray-50 border-none rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none font-bold" />
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input {...register('company_phone')} placeholder="Tel√©fono" className="w-full px-4 py-3 bg-gray-50 border-none rounded-2xl outline-none" />
                        <input {...register('company_email')} placeholder="Email" className="w-full px-4 py-3 bg-gray-50 border-none rounded-2xl outline-none" />
                    </div>
                </div>
            </div>
          </div>
        </div>

        {/* 2. FINANZAS */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div className="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm">
                <h3 className="font-bold text-gray-400 text-[10px] uppercase mb-4 flex items-center gap-2">
                    <DollarSign size={14} className="text-green-500"/> Tasa de Cambio (CUP)
                </h3>
                <div className="relative">
                    <input type="number" step="0.01" {...register('default_exchange_rate')} className="w-full px-4 py-4 bg-green-50/50 border-none rounded-2xl text-3xl font-black text-green-700 outline-none" />
                    <button type="button" onClick={handleManualSync} className="absolute right-2 top-2 p-2 bg-green-600 text-white rounded-xl shadow-md active:scale-90 transition-transform">
                        <RefreshCw size={18} className={syncing ? "animate-spin" : ""} />
                    </button>
                </div>
            </div>

            <div className="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm">
                <h3 className="font-bold text-gray-400 text-[10px] uppercase mb-4 flex items-center gap-2">
                    <Info size={14} className="text-orange-500"/> Comisi√≥n Vendedores
                </h3>
                <div className="relative">
                    <input type="number" {...register('seller_commission_percentage')} className="w-full px-4 py-4 bg-orange-50/50 border-none rounded-2xl text-3xl font-black text-orange-700 outline-none" />
                    <span className="absolute right-4 top-4 text-orange-200 font-black text-2xl">%</span>
                </div>
            </div>
        </div>

        {/* 3. AUTOMATIZACI√ìN (Incluye el Reporte Anual) */}
        <div className="bg-white rounded-3xl shadow-sm border border-gray-100 overflow-hidden">
            <div className="p-4 border-b border-gray-50 bg-gray-50/50 flex items-center gap-2">
                <Clock className="text-purple-500" size={18} />
                <h2 className="font-bold text-gray-800 uppercase text-[10px] tracking-wider">Reportes y Sincronizaci√≥n</h2>
            </div>
            
            <div className="p-4 space-y-4">
                {/* Sincronizaci√≥n de Tasa */}
                <div className="flex items-center justify-between p-3 bg-gray-50 rounded-2xl">
                    <div className="flex items-center gap-3">
                        <RefreshCw size={16} className="text-purple-400" />
                        <span className="text-sm font-bold text-gray-700">Auto-Sincronizar Tasa</span>
                    </div>
                    <input type="time" {...register('exchange_rate_sync_time')} className="bg-white px-2 py-1 rounded-lg border-none font-bold text-purple-600 outline-none shadow-sm" />
                </div>

                {/* Reporte Mensual */}
                <div className="flex flex-col sm:flex-row sm:items-center justify-between p-3 bg-gray-50 rounded-2xl gap-3">
                    <div className="flex items-center gap-3">
                        <FileText size={16} className="text-blue-400" />
                        <span className="text-sm font-bold text-gray-700">Reporte Mensual</span>
                    </div>
                    <div className="flex items-center gap-2">
                        <input type="number" {...register('monthly_report_day')} className="w-12 px-2 py-1 rounded-lg border-none text-center font-bold" placeholder="D√≠a" />
                        <span className="text-gray-400 font-bold">@</span>
                        <input type="time" {...register('monthly_report_time')} className="px-2 py-1 rounded-lg border-none font-bold text-blue-600" />
                    </div>
                </div>

                {/* Reporte Anual (Diciembre) */}
                <div className="flex flex-col sm:flex-row sm:items-center justify-between p-3 bg-gray-50 rounded-2xl gap-3 border-l-4 border-orange-400">
                    <div className="flex items-center gap-3">
                        <Calendar size={16} className="text-orange-500" />
                        <div>
                            <span className="text-sm font-bold text-gray-700">Reporte Anual</span>
                            <p className="text-[9px] text-orange-600 font-bold">CIERRE DE DICIEMBRE</p>
                        </div>
                    </div>
                    <div className="flex items-center gap-2">
                        <input type="number" {...register('annual_report_day')} className="w-12 px-2 py-1 rounded-lg border-none text-center font-bold" placeholder="D√≠a" />
                        <span className="text-gray-400 font-bold">@</span>
                        <input type="time" {...register('annual_report_time')} className="px-2 py-1 rounded-lg border-none font-bold text-orange-600" />
                    </div>
                </div>
            </div>
        </div>

        {/* 4. TELEGRAM BOT */}
        <div className="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm">
          <div className="flex items-center gap-3 mb-4">
            <Bot className="text-blue-400" size={20} />
            <h2 className="font-bold text-gray-800 uppercase text-xs">Telegram Bot Token</h2>
          </div>
          <input type="password" {...register('telegram_bot_token')} placeholder="Bot API Token" className="w-full px-4 py-3 bg-gray-50 border-none rounded-2xl font-mono text-sm outline-none focus:ring-2 focus:ring-blue-400" />
        </div>

        {/* BOT√ìN GUARDAR */}
        <div className="pt-4">
            <button type="submit" disabled={saving} className="w-full py-4 bg-blue-600 text-white font-black rounded-2xl shadow-xl shadow-blue-200 flex items-center justify-center gap-3 transition-all active:scale-95 disabled:opacity-50">
                {saving ? <Loader2 className="animate-spin" /> : <Save size={20} />}
                GUARDAR CONFIGURACI√ìN
            </button>
        </div>

      </form>
    </div>
  );
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\pages\Shipments.jsx
============================================
// src/pages/Shipments.jsx
import { useState } from 'react';
import { useQuery, useMutation } from '@apollo/client';
import { GET_SHIPMENTS, CREATE_SHIPMENT, UPDATE_SHIPMENT, DELETE_SHIPMENT } from '../graphql/shipments';
import { Truck, Plus, Edit2, Trash2, Calendar, Loader2, AlertCircle, DollarSign, Globe, ClipboardList } from 'lucide-react';
import ShipmentModal from '../components/shipments/ShipmentModal';
import toast from 'react-hot-toast';
import TablePagination from '../components/ui/TablePagination';

export default function Shipments() {
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingShipment, setEditingShipment] = useState(null);
  const [currentPage, setCurrentPage] = useState(1);
  const itemsPerPage = 10;

  const { data, loading, error } = useQuery(GET_SHIPMENTS);

  const [createShipment, { loading: creating }] = useMutation(CREATE_SHIPMENT, {
    refetchQueries: [{ query: GET_SHIPMENTS }]
  });
  const [updateShipment, { loading: updating }] = useMutation(UPDATE_SHIPMENT, {
    refetchQueries: [{ query: GET_SHIPMENTS }]
  });
  const [deleteShipment] = useMutation(DELETE_SHIPMENT, {
    refetchQueries: [{ query: GET_SHIPMENTS }]
  });

  const allShipments = data?.shipments || [];
  const indexOfLastItem = currentPage * itemsPerPage;
  const indexOfFirstItem = indexOfLastItem - itemsPerPage;
  const currentShipments = allShipments.slice(indexOfFirstItem, indexOfLastItem);

  const handleOpenCreate = () => {
    setEditingShipment(null);
    setIsModalOpen(true);
  };

  const handleOpenEdit = (shipment) => {
    setEditingShipment(shipment);
    setIsModalOpen(true);
  };

  const getDisplayDate = (rawDate) => {
    const date = new Date(Number(rawDate) || rawDate);
    if (isNaN(date.getTime())) {
      return { day: '--', month: '---', year: '----' };
    }
    return {
      day: date.getDate(),
      month: date.toLocaleString('es-ES', { month: 'short' }),
      year: date.getFullYear()
    };
  };

  const handleDelete = async (id) => {
    if (confirm('¬øEliminar este env√≠o? Se perder√° el registro de costos.')) {
      try {
        await deleteShipment({ variables: { id_shipment: id } });
        toast.success('Env√≠o eliminado');
      } catch (e) {
        toast.error('Error: ' + e.message);
      }
    }
  };

  const handleSave = async (data) => {
    const shipmentInput = {
      agency_name: data.agency_name,
      shipment_date: new Date(data.shipment_date).toISOString(),
      shipping_cost_usd: parseFloat(data.shipping_cost_usd),
      merchandise_cost_usd: parseFloat(data.merchandise_cost_usd),
      customs_fee_cup: parseFloat(data.customs_fee_cup),
      exchange_rate: parseFloat(data.exchange_rate),
      notes: data.notes
    };

    try {
      if (editingShipment) {
        await updateShipment({
          variables: { id_shipment: editingShipment.id_shipment, input: shipmentInput }
        });
        toast.success('Env√≠o actualizado');
      } else {
        await createShipment({ variables: shipmentInput });
        toast.success('Env√≠o registrado');
      }
      setIsModalOpen(false);
    } catch (e) {
      toast.error('Error: ' + e.message);
    }
  };

  if (loading) return <div className="flex justify-center p-20"><Loader2 className="animate-spin text-blue-600 h-10 w-10" /></div>;
  if (error) return <p className="text-center text-red-500 p-10">Error cargando env√≠os</p>;

  return (
    <div className="pb-20 max-w-7xl mx-auto px-2 md:px-0">
      
      {/* --- HEADER MEJORADO (Bot√≥n debajo en m√≥vil) --- */}
      <div className="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-8">
        <div className="text-left">
          <h1 className="text-2xl md:text-3xl font-bold text-gray-800 flex items-center">
            <Truck className="mr-3 text-blue-600" size={28} /> Gesti√≥n de Env√≠os
          </h1>
          <p className="text-gray-500 text-sm mt-1">
            Control de importaciones y log√≠stica internacional.
          </p>
        </div>
        
        {/* El bot√≥n ahora es w-full en m√≥vil por defecto y w-auto en tablets/pc */}
        <button 
          onClick={handleOpenCreate} 
          className="w-full md:w-auto bg-blue-600 hover:bg-blue-700 text-white px-6 py-3.5 rounded-2xl font-bold shadow-lg shadow-blue-200 flex items-center justify-center transition-all active:scale-95"
        >
          <Plus className="mr-2 h-5 w-5" /> Registrar Nuevo Env√≠o
        </button>
      </div>

      {/* --- LISTA DE ENV√çOS ESTILO "FINANCIAL" --- */}
      <div className="space-y-4">
        {allShipments.length === 0 && (
           <div className="text-center py-12 bg-white rounded-2xl border border-dashed border-gray-200">
             <AlertCircle className="mx-auto text-gray-300 h-12 w-12 mb-3" />
             <p className="text-gray-500 font-medium">No hay env√≠os registrados.</p>
           </div>
        )}

        {currentShipments.map((item) => {
          const dateData = getDisplayDate(item.shipment_date);
          const totalUsd = item.shipping_cost_usd + item.merchandise_cost_usd;

          return (
            <div key={item.id_shipment} className="relative overflow-hidden bg-white p-4 md:p-5 rounded-2xl shadow-sm border border-gray-100 hover:border-blue-200 hover:shadow-md transition-all">
              
              <div className="flex flex-col md:flex-row gap-4 md:items-center justify-between">
                
                {/* 1. Agencia y Fecha */}
                <div className="flex items-center gap-4">
                   <div className="h-14 w-14 bg-blue-50 text-blue-600 rounded-2xl flex flex-col items-center justify-center font-black border border-blue-100 flex-shrink-0 shadow-sm">
                      <span className="text-lg leading-none">{dateData.day}</span>
                      <span className="text-[10px] uppercase">{dateData.month}</span>
                   </div>
                   
                   <div className="min-w-0">
                     <h3 className="font-bold text-gray-800 text-lg leading-tight truncate">{item.agency_name}</h3>
                     <div className="flex items-center text-gray-500 text-xs mt-1 font-medium">
                        <Globe size={12} className="mr-1 text-blue-400" />
                        Tasa: {item.exchange_rate} CUP
                        <span className="mx-2 text-gray-300">‚Ä¢</span>
                        <span className="truncate">{item.notes || 'Sin observaciones'}</span>
                     </div>
                   </div>
                </div>

                {/* 2. Resumen de Costos (Muy visual) */}
                <div className="grid grid-cols-2 md:flex md:items-center gap-4 md:gap-8 border-y md:border-y-0 py-3 md:py-0 border-gray-50">
                  <div className="text-left md:text-center">
                    <span className="text-[10px] text-gray-400 font-bold uppercase block mb-0.5">Inversi√≥n Total</span>
                    <p className="text-lg font-black text-gray-800">${totalUsd.toFixed(2)}<span className="text-[10px] ml-1 text-gray-400">USD</span></p>
                  </div>
                  <div className="text-left md:text-center">
                    <span className="text-[10px] text-gray-400 font-bold uppercase block mb-0.5">Arancel Aduana</span>
                    <p className="text-lg font-black text-orange-600">${item.customs_fee_cup.toFixed(0)}<span className="text-[10px] ml-1 text-gray-400">CUP</span></p>
                  </div>
                </div>

                {/* 3. Acciones */}
                <div className="flex gap-2 justify-end">
                  <button 
                    onClick={() => handleOpenEdit(item)} 
                    className="p-3 bg-blue-50 text-blue-600 hover:bg-blue-100 rounded-xl transition-all active:scale-90"
                    title="Editar env√≠o"
                  >
                    <Edit2 size={20} />
                  </button>
                  <button 
                    onClick={() => handleDelete(item.id_shipment)} 
                    className="p-3 bg-red-50 text-red-500 hover:bg-red-100 rounded-xl transition-all active:scale-90"
                    title="Eliminar registro"
                  >
                    <Trash2 size={20} />
                  </button>
                </div>

              </div>
              
              {/* Badge discreto de "Detalles" en m√≥vil */}
              <div className="mt-3 flex items-center gap-3 md:hidden">
                 <div className="flex items-center gap-1 text-[10px] bg-gray-100 text-gray-600 px-2 py-1 rounded-lg font-bold">
                    <ClipboardList size={10}/> ENV√çO: ${item.shipping_cost_usd}
                 </div>
                 <div className="flex items-center gap-1 text-[10px] bg-gray-100 text-gray-600 px-2 py-1 rounded-lg font-bold">
                    <DollarSign size={10}/> PRODUCTOS: ${item.merchandise_cost_usd}
                 </div>
              </div>

            </div>
          );
        })}
      </div>

      <TablePagination 
        currentPage={currentPage}
        totalItems={allShipments.length}
        itemsPerPage={itemsPerPage}
        onPageChange={setCurrentPage}
      />

      <ShipmentModal 
        isOpen={isModalOpen}
        onClose={() => setIsModalOpen(false)}
        shipmentToEdit={editingShipment}
        onSave={handleSave}
        isSaving={creating || updating}
      />
    </div>
  );
}.
.
============================================
Archivo: C:\Users\gabry\Desktop\Habana Express Store\habana-express-app\src\pages\Users.jsx
============================================
// src/pages/Users.jsx
import { useState } from 'react';
import { useQuery, useMutation } from '@apollo/client';
import { GET_USERS, CREATE_USER, UPDATE_USER, DELETE_USER } from '../graphql/users';
import { Plus, Search, Edit2, Trash2, User as UserIcon, Loader2, AlertCircle, Phone, MessageSquare, ShieldCheck, Mail } from 'lucide-react';
import UserModal from '../components/users/UserModal';
import toast from 'react-hot-toast';
import clsx from 'clsx';

export default function Users() {
  const [searchTerm, setSearchTerm] = useState('');
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingUser, setEditingUser] = useState(null);

  const { data, loading, error } = useQuery(GET_USERS);
  
  const [createUser, { loading: creating }] = useMutation(CREATE_USER, { refetchQueries: [{ query: GET_USERS }] });
  const [updateUser, { loading: updating }] = useMutation(UPDATE_USER, { refetchQueries: [{ query: GET_USERS }] });
  const [deleteUser] = useMutation(DELETE_USER, { refetchQueries: [{ query: GET_USERS }] });

  const filteredUsers = data?.users?.filter(u => 
     u.active && (u.name.toLowerCase().includes(searchTerm.toLowerCase()) || u.phone.includes(searchTerm))
  ) || [];

  const handleOpenCreate = () => { setEditingUser(null); setIsModalOpen(true); };
  const handleOpenEdit = (user) => { setEditingUser(user); setIsModalOpen(true); };

  const handleDelete = async (user) => {
    if (window.confirm(`¬øDesactivar a ${user.name}?`)) {
       try {
         await deleteUser({ variables: { id_user: user.id_user } });
         toast.success('Usuario desactivado');
       } catch (e) { toast.error(e.message); }
    }
  };

  const handleSave = async (data) => {
    try {
        if (editingUser) {
            const input = { ...data, active: true };
            delete input.__typename;
            await updateUser({ variables: { id_user: editingUser.id_user, input } });
            toast.success('Actualizado');
        } else {
            const createInput = { ...data, password_hash: data.password };
            await createUser({ variables: { input: createInput } });
            toast.success('Usuario creado');
        }
        setIsModalOpen(false);
    } catch (e) { toast.error(e.message); }
  };

  if (loading) return <div className="flex justify-center p-20"><Loader2 className="animate-spin text-blue-600 h-10 w-10" /></div>;

  return (
    <div className="pb-20 px-2 md:px-0">
       
       {/* HEADER ESTANDARIZADO */}
       <div className="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-8 text-left">
         <div>
            <h1 className="text-2xl md:text-3xl font-black text-gray-800 flex items-center">
                <ShieldCheck className="mr-3 text-blue-600" size={28} /> Gesti√≥n de Equipo
            </h1>
            <p className="text-gray-500 text-sm mt-1">Administra el acceso y roles del personal.</p>
         </div>
         <button onClick={handleOpenCreate} className="w-full md:w-auto bg-blue-600 text-white px-6 py-3.5 rounded-2xl font-black shadow-lg shadow-blue-100 flex items-center justify-center active:scale-95 transition-all">
            <Plus className="mr-2 h-5 w-5" /> A√±adir Miembro
         </button>
       </div>

       {/* BUSCADOR ESTILO MODERNO */}
       <div className="relative mb-6">
          <Search className="absolute left-4 top-3.5 text-gray-400" size={20} />
          <input 
            type="text" 
            placeholder="Buscar por nombre o tel√©fono..." 
            value={searchTerm}
            onChange={e => setSearchTerm(e.target.value)}
            className="w-full pl-12 pr-4 py-3.5 bg-white border border-gray-100 rounded-2xl shadow-sm focus:ring-2 focus:ring-blue-500 outline-none font-medium"
          />
       </div>

       {/* LISTA DE USUARIOS (TARJETAS HORIZONTALES) */}
       <div className="grid grid-cols-1 gap-4">
          {filteredUsers.map(user => {
             const isAdmin = user.role === 'admin';
             const isStore = user.role === 'storekeeper';
             
             return (
                <div key={user.id_user} className="bg-white p-4 rounded-3xl shadow-sm border border-gray-50 flex flex-col md:flex-row md:items-center justify-between gap-4 relative overflow-hidden">
                    
                    {/* Indicador lateral de rol */}
                    <div className={clsx("absolute left-0 top-0 bottom-0 w-1.5", 
                        isAdmin ? "bg-purple-500" : isStore ? "bg-orange-500" : "bg-blue-500"
                    )}></div>

                    <div className="flex items-center gap-4">
                        {/* Avatar con borde de color seg√∫n rol */}
                        <div className={clsx(
                            "h-20 w-20 rounded-full p-1 flex-shrink-0 border-2",
                            isAdmin ? "border-purple-100" : isStore ? "border-orange-100" : "border-blue-100"
                        )}>
                            <div className="h-full w-full rounded-full bg-gray-50 overflow-hidden">
                                {user.photo_url ? (
                                    <img src={user.photo_url} className="w-full h-full object-cover" />
                                ) : (
                                    <UserIcon className="h-full w-full p-3 text-gray-300" />
                                )}
                            </div>
                        </div>

                        <div>
                            <h3 className="font-black text-gray-800 text-lg leading-tight">{user.name}</h3>
                            <div className="flex flex-wrap items-center gap-2 mt-1">
                                <span className={clsx(
                                    "px-2 py-0.5 rounded-lg text-[10px] font-black uppercase tracking-widest",
                                    isAdmin ? "bg-purple-50 text-purple-600" :
                                    isStore ? "bg-orange-50 text-orange-600" :
                                    "bg-blue-50 text-blue-600"
                                )}>
                                    {user.role}
                                </span>
                                <span className="text-gray-300 font-bold">‚Ä¢</span>
                                <div className="flex items-center text-gray-400 font-mono text-xs font-bold">
                                    <Phone size={10} className="mr-1"/> {user.phone}
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* BOTONES DE ACCI√ìN R√ÅPIDA */}
                    <div className="flex items-center justify-between border-t border-gray-50 pt-3 md:border-none md:pt-0 gap-2">
                        <div className="flex gap-2">
                            {/* Llamada Directa */}
                            <a href={`tel:${user.phone}`} className="p-3 bg-gray-50 text-gray-600 rounded-xl hover:bg-green-50 hover:text-green-600 transition-colors">
                                <Phone size={18} />
                            </a>
                            {/* WhatsApp Directo */}
                            <a href={`https://wa.me/${user.phone}`} target="_blank" rel="noreferrer" className="p-3 bg-gray-50 text-gray-600 rounded-xl hover:bg-green-50 hover:text-green-600 transition-colors">
                                <MessageSquare size={18} />
                            </a>
                        </div>
                        
                        <div className="flex gap-2">
                            <button onClick={() => handleOpenEdit(user)} className="p-3 bg-blue-50 text-blue-600 rounded-xl active:scale-90 transition-all">
                                <Edit2 size={18} />
                            </button>
                            <button onClick={() => handleDelete(user)} className="p-3 bg-red-50 text-red-500 rounded-xl active:scale-90 transition-all">
                                <Trash2 size={18} />
                            </button>
                        </div>
                    </div>
                </div>
             );
          })}

          {filteredUsers.length === 0 && (
             <div className="text-center py-20 bg-white rounded-3xl border border-dashed border-gray-200">
                <AlertCircle className="mx-auto h-12 w-12 text-gray-200 mb-3" />
                <p className="text-gray-400 font-bold">No hay usuarios activos.</p>
             </div>
          )}
       </div>

       <UserModal 
          isOpen={isModalOpen} onClose={() => setIsModalOpen(false)}
          userToEdit={editingUser} onSave={handleSave}
          isSaving={creating || updating} isAdmin={true}
       />
    </div>
  );
}.
.
